/*!
 * Application Insights JavaScript SDK - Web, 2.2.2
 * Copyright (c) Microsoft and contributors. All rights reserved.
 */
!function (e, t) { "object" == typeof exports && "undefined" != typeof module ? t(exports) : "function" == typeof define && define.amd ? define(["exports"], t) : t((e.Microsoft = e.Microsoft || {}, e.Microsoft.ApplicationInsights = {})) }(this, function (e) { "use strict"; var r, t, g, i, s, n; (t = r = r || {})[t.LocalStorage = 0] = "LocalStorage", t[t.SessionStorage = 1] = "SessionStorage", (i = g = g || {})[i.Default = 0] = "Default", i[i.Required = 1] = "Required", i[i.Array = 2] = "Array", i[i.Hidden = 4] = "Hidden", (n = s = s || {})[n.AI = 0] = "AI", n[n.AI_AND_W3C = 1] = "AI_AND_W3C", n[n.W3C = 2] = "W3C"; var a = 2, m = (o.isNullOrUndefined = function (e) { return null == e }, o.disableCookies = function () { o._canUseCookies = !1 }, o.newGuid = function () { return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(l, function (e) { var t = 16 * Math.random() | 0; return ("x" === e ? t : 3 & t | 8).toString(16) }) }, o); function o() { } var v, c, l = /[xy]/g, u = (p.prototype.addNotificationListener = function (e) { this.listeners.push(e) }, p.prototype.removeNotificationListener = function (e) { for (var t = this.listeners.indexOf(e); -1 < t;)this.listeners.splice(t, 1), t = this.listeners.indexOf(e) }, p.prototype.eventsSent = function (t) { for (var i = this, e = function (e) { n.listeners[e].eventsSent && setTimeout(function () { return i.listeners[e].eventsSent(t) }, 0) }, n = this, r = 0; r < this.listeners.length; ++r)e(r) }, p.prototype.eventsDiscarded = function (t, i) { for (var n = this, e = function (e) { r.listeners[e].eventsDiscarded && setTimeout(function () { return n.listeners[e].eventsDiscarded(t, i) }, 0) }, r = this, a = 0; a < this.listeners.length; ++a)e(a) }, p); function p() { this.listeners = [] } (c = v = v || {})[c.CRITICAL = 1] = "CRITICAL", c[c.WARNING = 2] = "WARNING"; var h = 0, d = 1, f = 2, y = 3, x = 4, I = 5, _ = 6, w = 7, b = 8, T = 9, D = 10, S = 11, C = 12, E = 13, N = 14, A = 15, k = 16, R = 17, M = 18, P = 19, U = 20, L = 22, O = 23, q = 24, H = 25, j = 26, F = 27, z = 28, V = 29, B = 30, G = 31, W = 32, X = 33, K = 35, J = 36, Y = 37, Q = 38, Z = 39, $ = 40, ee = 41, te = 42, ie = 43, ne = 45, re = 46, ae = 47, oe = 48, se = 49, ce = 50, le = 52, ue = 54, pe = 55, he = 56, de = 57, ge = 58, fe = 60, me = 61, ve = 62, ye = 63, xe = 64, Ie = 66, _e = 67, we = 68, be = 69, Te = 70, De = 71, Se = (Ce.sanitizeDiagnosticText = function (e) { return '"' + e.replace(/\"/g, "") + '"' }, Ce.dataType = "MessageData", Ce.AiNonUserActionablePrefix = "AI (Internal): ", Ce.AiUserActionablePrefix = "AI: ", Ce); function Ce(e, t, i, n) { void 0 === i && (i = !1), this.messageId = e, this.message = (i ? Ce.AiUserActionablePrefix : Ce.AiNonUserActionablePrefix) + e; var r = (t ? " message:" + Ce.sanitizeDiagnosticText(t) : "") + (n ? " props:" + Ce.sanitizeDiagnosticText(JSON.stringify(n)) : ""); this.message += r } var Ee = (Ne.prototype.throwInternal = function (e, t, i, n, r) { void 0 === r && (r = !1); var a = new Se(t, i, r, n); if (this.enableDebugExceptions()) throw a; if (void 0 !== a && a && void 0 !== a.message) { if (r) { var o = +a.messageId; (!this._messageLogged[o] || this.consoleLoggingLevel() >= v.WARNING) && (this.warnToConsole(a.message), this._messageLogged[o] = !0) } else this.consoleLoggingLevel() >= v.WARNING && this.warnToConsole(a.message); this.logInternalMessage(e, a) } }, Ne.prototype.warnToConsole = function (e) { "undefined" != typeof console && console && ("function" == typeof console.warn ? console.warn(e) : "function" == typeof console.log && console.log(e)) }, Ne.prototype.resetInternalMessageCount = function () { this._messageCount = 0, this._messageLogged = {} }, Ne.prototype.logInternalMessage = function (e, t) { if (!this._areInternalMessagesThrottled()) { var i = !0, n = this.AIInternalMessagePrefix + t.messageId; if (this._messageLogged[n] ? i = !1 : this._messageLogged[n] = !0, i && (e <= this.telemetryLoggingLevel() && (this.queue.push(t), this._messageCount++), this._messageCount == this.maxInternalMessageLimit())) { var r = "Internal events throttle limit per PageView reached for this app.", a = new Se(O, r, !1); this.queue.push(a), this.warnToConsole(r) } } }, Ne.prototype._areInternalMessagesThrottled = function () { return this._messageCount >= this.maxInternalMessageLimit() }, Ne); function Ne(e) { this.AIInternalMessagePrefix = "AITR_", this.enableDebugExceptions = function () { return !1 }, this.consoleLoggingLevel = function () { return 0 }, this.telemetryLoggingLevel = function () { return 1 }, this.maxInternalMessageLimit = function () { return 25 }, this.queue = [], this._messageCount = 0, this._messageLogged = {}, m.isNullOrUndefined(e) || (m.isNullOrUndefined(e.loggingLevelConsole) || (this.consoleLoggingLevel = function () { return e.loggingLevelConsole }), m.isNullOrUndefined(e.loggingLevelTelemetry) || (this.telemetryLoggingLevel = function () { return e.loggingLevelTelemetry }), m.isNullOrUndefined(e.maxMessageLimit) || (this.maxInternalMessageLimit = function () { return e.maxMessageLimit }), m.isNullOrUndefined(e.enableDebugExceptions) || (this.enableDebugExceptions = function () { return e.enableDebugExceptions })) } var Ae = (ke.prototype.processTelemetry = function (t) { this.channelQueue.forEach(function (e) { 0 < e.length && e[0].processTelemetry(t) }) }, Object.defineProperty(ke.prototype, "ChannelControls", { get: function () { return this.channelQueue }, enumerable: !0, configurable: !0 }), ke.prototype.initialize = function (i, n, r) { var a = this; if (i.isCookieUseDisabled && m.disableCookies(), this.channelQueue = new Array, i.channels) { var o = void 0; i.channels.forEach(function (e) { if (e && 0 < e.length) { e = e.sort(function (e, t) { return e.priority - t.priority }); for (var t = 1; t < e.length; t++)e[t - 1].setNextPlugin(e[t]); if (e.forEach(function (e) { e.priority < 500 && (o = e.identifier), e.initialize(i, n, r) }), o) throw Error("Channel has invalid priority" + o); a.channelQueue.push(e) } }) } for (var e = new Array, t = 0; t < r.length; t++) { var s = r[t]; 500 < s.priority && e.push(s) } if (0 < e.length) { for (e = e.sort(function (e, t) { return e.priority - t.priority }), t = 1; t < e.length; t++)e[t - 1].setNextPlugin(e[t]); e.forEach(function (e) { return e.initialize(i, n, r) }), this.channelQueue.push(e) } }, ke); function ke() { this.identifier = "ChannelControllerPlugin", this.priority = 500 } var Re = (Me.prototype.initialize = function (e, t) { var i = this; if (this._isInitialized) throw Error("Core should not be initialized more than once"); if (!e || m.isNullOrUndefined(e.instrumentationKey)) throw Error("Please provide instrumentation key"); this.config = e, this._notificationManager = new u, this.config.extensions = m.isNullOrUndefined(this.config.extensions) ? [] : this.config.extensions, this.config.extensionConfig = m.isNullOrUndefined(this.config.extensionConfig) ? {} : this.config.extensionConfig, this.config.extensionConfig.NotificationManager = this._notificationManager, this.logger = new Ee(e), (r = this._extensions).push.apply(r, t.concat(this.config.extensions)), this._extensions.forEach(function (e) { var t = !0; if ((m.isNullOrUndefined(e) || m.isNullOrUndefined(e.initialize)) && (t = !1), !t) throw Error("Extensions must provide callback to initialize") }), this._extensions.push(this._channelController), this._extensions = this._extensions.sort(function (e, t) { var i = e, n = t, r = typeof i.processTelemetry, a = typeof n.processTelemetry; return "function" == r && "function" == a ? i.priority - n.priority : "function" == r && "function" != a ? 1 : "function" != r && "function" == a ? -1 : void 0 }); var n = {}; this._extensions.forEach(function (e) { var t = e; t && t.priority && (m.isNullOrUndefined(n[t.priority]) ? n[t.priority] = t.identifier : i.logger.warnToConsole("Two extensions have same priority" + n[t.priority] + ", " + t.identifier)) }); for (var r, a = -1, o = 0; o < this._extensions.length - 1; o++) { var s = this._extensions[o]; if (!s || "function" == typeof s.processTelemetry) { if (s.priority === this._channelController.priority) { a = o + 1; break } this._extensions[o].setNextPlugin(this._extensions[o + 1]) } } if (this._channelController.initialize(this.config, this, this._extensions), this._extensions.forEach(function (e) { e && e.priority < i._channelController.priority && e.initialize(i.config, i, i._extensions) }), a < this._extensions.length && this._extensions.splice(a), 0 === this.getTransmissionControls().length) throw new Error("No channels available"); this._isInitialized = !0 }, Me.prototype.getTransmissionControls = function () { return this._channelController.ChannelControls }, Me.prototype.track = function (e) { if (null === e) throw this._notifyInvalidEvent(e), Error("Invalid telemetry item"); e.iKey || (e.iKey = this.config.instrumentationKey), e.time || (e.time = (new Date).toISOString()), m.isNullOrUndefined(e.ver) && (e.ver = "4.0"), this._validateTelmetryItem(e), 0 == this._extensions.length && this._channelController.processTelemetry(e); for (var t = 0; t < this._extensions.length;) { if (this._extensions[t].processTelemetry) { this._extensions[t].processTelemetry(e); break } t++ } }, Me.prototype.addNotificationListener = function (e) { this._notificationManager.addNotificationListener(e) }, Me.prototype.removeNotificationListener = function (e) { this._notificationManager.removeNotificationListener(e) }, Me.prototype.pollInternalLogs = function (i) { var n = this, e = this.config.diagnosticLogInterval; return 0 < e || (e = 1e4), setInterval(function () { var e = n.logger.queue; e.forEach(function (e) { var t = { name: i || "InternalMessageId: " + e.messageId, iKey: n.config.instrumentationKey, time: (new Date).toISOString(), baseType: Se.dataType, baseData: { message: e.message } }; n.track(t) }), e.length = 0 }, e) }, Me.prototype._validateTelmetryItem = function (e) { if (m.isNullOrUndefined(e.name)) throw this._notifyInvalidEvent(e), Error("telemetry name required"); if (m.isNullOrUndefined(e.time)) throw this._notifyInvalidEvent(e), Error("telemetry timestamp required"); if (m.isNullOrUndefined(e.iKey)) throw this._notifyInvalidEvent(e), Error("telemetry instrumentationKey required") }, Me.prototype._notifyInvalidEvent = function (e) { this._notificationManager.eventsDiscarded([e], a) }, Me); function Me() { this._isInitialized = !1, this._extensions = new Array, this._channelController = new Ae } var Pe = (Ue.requestContextHeader = "Request-Context", Ue.requestContextTargetKey = "appId", Ue.requestContextAppIdFormat = "appId=cid-v1:", Ue.requestIdHeader = "Request-Id", Ue.traceParentHeader = "traceparent", Ue.sdkContextHeader = "Sdk-Context", Ue.sdkContextHeaderAppIdRequest = "appId", Ue.requestContextHeaderLowerCase = "request-context", Ue); function Ue() { } var Le = (Oe.sanitizeKeyAndAddUniqueness = function (e, t, i) { var n = t.length, r = Oe.sanitizeKey(e, t); if (r.length !== n) { for (var a = 0, o = r; void 0 !== i[o];)a++ , o = r.substring(0, Oe.MAX_NAME_LENGTH - 3) + Oe.padNumber(a); r = o } return r }, Oe.sanitizeKey = function (e, t) { var i; return t && (t = Oe.trim(t.toString())).length > Oe.MAX_NAME_LENGTH && (i = t.substring(0, Oe.MAX_NAME_LENGTH), e.throwInternal(v.WARNING, de, "name is too long.  It has been truncated to " + Oe.MAX_NAME_LENGTH + " characters.", { name: t }, !0)), i || t }, Oe.sanitizeString = function (e, t, i) { var n; return void 0 === i && (i = Oe.MAX_STRING_LENGTH), t && (i = i || Oe.MAX_STRING_LENGTH, (t = Oe.trim(t)).toString().length > i && (n = t.toString().substring(0, i), e.throwInternal(v.WARNING, me, "string value is too long. It has been truncated to " + i + " characters.", { value: t }, !0))), n || t }, Oe.sanitizeUrl = function (e, t) { return Oe.sanitizeInput(e, t, Oe.MAX_URL_LENGTH, Ie) }, Oe.sanitizeMessage = function (e, t) { var i; return t && t.length > Oe.MAX_MESSAGE_LENGTH && (i = t.substring(0, Oe.MAX_MESSAGE_LENGTH), e.throwInternal(v.WARNING, he, "message is too long, it has been truncated to " + Oe.MAX_MESSAGE_LENGTH + " characters.", { message: t }, !0)), i || t }, Oe.sanitizeException = function (e, t) { var i; return t && t.length > Oe.MAX_EXCEPTION_LENGTH && (i = t.substring(0, Oe.MAX_EXCEPTION_LENGTH), e.throwInternal(v.WARNING, le, "exception is too long, it has been truncated to " + Oe.MAX_EXCEPTION_LENGTH + " characters.", { exception: t }, !0)), i || t }, Oe.sanitizeProperties = function (t, e) { if (e) { var i = {}; for (var n in e) { var r = e[n]; if ("object" == typeof r && "undefined" != typeof JSON) try { r = JSON.stringify(r) } catch (e) { t.throwInternal(v.WARNING, se, "custom property is not valid", { exception: e }, !0) } r = Oe.sanitizeString(t, r, Oe.MAX_PROPERTY_LENGTH), i[n = Oe.sanitizeKeyAndAddUniqueness(t, n, i)] = r } e = i } return e }, Oe.sanitizeMeasurements = function (e, t) { if (t) { var i = {}; for (var n in t) { var r = t[n]; i[n = Oe.sanitizeKeyAndAddUniqueness(e, n, i)] = r } t = i } return t }, Oe.sanitizeId = function (e, t) { return t ? Oe.sanitizeInput(e, t, Oe.MAX_ID_LENGTH, be).toString() : t }, Oe.sanitizeInput = function (e, t, i, n) { var r; return t && (t = Oe.trim(t)).length > i && (r = t.substring(0, i), e.throwInternal(v.WARNING, n, "input is too long, it has been truncated to " + i + " characters.", { data: t }, !0)), r || t }, Oe.padNumber = function (e) { var t = "00" + e; return t.substr(t.length - 3) }, Oe.trim = function (e) { return "string" != typeof e ? e : e.replace(/^\s+|\s+$/g, "") }, Oe.MAX_NAME_LENGTH = 150, Oe.MAX_ID_LENGTH = 128, Oe.MAX_PROPERTY_LENGTH = 8192, Oe.MAX_STRING_LENGTH = 1024, Oe.MAX_URL_LENGTH = 2048, Oe.MAX_MESSAGE_LENGTH = 32768, Oe.MAX_EXCEPTION_LENGTH = 32768, Oe); function Oe() { } var qe = (He.createDomEvent = function (e) { var t = null; return "function" == typeof Event ? t = new Event(e) : (t = document.createEvent("Event")).initEvent(e, !0, !0), t }, He.disableStorage = function () { He._canUseLocalStorage = !1, He._canUseSessionStorage = !1 }, He._getLocalStorageObject = function () { return He.canUseLocalStorage() ? He._getVerifiedStorageObject(r.LocalStorage) : null }, He._getVerifiedStorageObject = function (e) { var t, i, n = null; try { if ("undefined" == typeof window) return null; i = new Date, (n = e === r.LocalStorage ? window.localStorage : window.sessionStorage).setItem(i, i), t = n.getItem(i) != i, n.removeItem(i), t && (n = null) } catch (e) { n = null } return n }, He.isInternalApplicationInsightsEndpoint = function (e) { return -1 !== He._internalEndpoints.indexOf(e.toLowerCase()) }, He.canUseLocalStorage = function () { return void 0 === He._canUseLocalStorage && (He._canUseLocalStorage = !!He._getVerifiedStorageObject(r.LocalStorage)), He._canUseLocalStorage }, He.getStorage = function (t, e) { var i = He._getLocalStorageObject(); if (null !== i) try { return i.getItem(e) } catch (e) { He._canUseLocalStorage = !1, t.throwInternal(v.WARNING, d, "Browser failed read of local storage. " + He.getExceptionName(e), { exception: He.dump(e) }) } return null }, He.setStorage = function (t, e, i) { var n = He._getLocalStorageObject(); if (null !== n) try { return n.setItem(e, i), !0 } catch (e) { He._canUseLocalStorage = !1, t.throwInternal(v.WARNING, y, "Browser failed write to local storage. " + He.getExceptionName(e), { exception: He.dump(e) }) } return !1 }, He.removeStorage = function (t, e) { var i = He._getLocalStorageObject(); if (null !== i) try { return i.removeItem(e), !0 } catch (e) { He._canUseLocalStorage = !1, t.throwInternal(v.WARNING, I, "Browser failed removal of local storage item. " + He.getExceptionName(e), { exception: He.dump(e) }) } return !1 }, He._getSessionStorageObject = function () { return He.canUseSessionStorage() ? He._getVerifiedStorageObject(r.SessionStorage) : null }, He.canUseSessionStorage = function () { return void 0 === He._canUseSessionStorage && (He._canUseSessionStorage = !!He._getVerifiedStorageObject(r.SessionStorage)), He._canUseSessionStorage }, He.getSessionStorageKeys = function () { var e = []; if (He.canUseSessionStorage()) for (var t in window.sessionStorage) e.push(t); return e }, He.getSessionStorage = function (t, e) { var i = He._getSessionStorageObject(); if (null !== i) try { return i.getItem(e) } catch (e) { He._canUseSessionStorage = !1, t.throwInternal(v.WARNING, f, "Browser failed read of session storage. " + He.getExceptionName(e), { exception: He.dump(e) }) } return null }, He.setSessionStorage = function (t, e, i) { var n = He._getSessionStorageObject(); if (null !== n) try { return n.setItem(e, i), !0 } catch (e) { He._canUseSessionStorage = !1, t.throwInternal(v.WARNING, x, "Browser failed write to session storage. " + He.getExceptionName(e), { exception: He.dump(e) }) } return !1 }, He.removeSessionStorage = function (t, e) { var i = He._getSessionStorageObject(); if (null !== i) try { return i.removeItem(e), !0 } catch (e) { He._canUseSessionStorage = !1, t.throwInternal(v.WARNING, _, "Browser failed removal of session storage item. " + He.getExceptionName(e), { exception: He.dump(e) }) } return !1 }, He.disableCookies = function () { m.disableCookies() }, He.canUseCookies = function (t) { if (void 0 === m._canUseCookies) { m._canUseCookies = !1; try { m._canUseCookies = void 0 !== He.document.cookie } catch (e) { t.throwInternal(v.WARNING, we, "Cannot access document.cookie - " + He.getExceptionName(e), { exception: He.dump(e) }) } } return m._canUseCookies }, He.setCookie = function (e, t, i, n) { var r = "", a = ""; n && (r = ";domain=" + n), He.document.location && "https:" === He.document.location.protocol && (a = ";secure"), He.canUseCookies(e) && (He.document.cookie = t + "=" + i + r + ";path=/" + a) }, He.stringToBoolOrDefault = function (e, t) { return void 0 === t && (t = !1), null == e ? t : "true" === e.toString().toLowerCase() }, He.getCookie = function (e, t) { if (He.canUseCookies(e)) { var i = ""; if (t && t.length) for (var n = t + "=", r = He.document.cookie.split(";"), a = 0; a < r.length; a++) { var o = r[a]; if ((o = He.trim(o)) && 0 === o.indexOf(n)) { i = o.substring(n.length, r[a].length); break } } return i } }, He.deleteCookie = function (e, t) { He.canUseCookies(e) && (He.document.cookie = t + "=;path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;") }, He.trim = function (e) { return "string" != typeof e ? e : e.replace(/^\s+|\s+$/g, "") }, He.newId = function () { for (var e = "", t = 1073741824 * Math.random(); 0 < t;)e += "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(t % 64), t = Math.floor(t / 64); return e }, He.random32 = function () { return 4294967296 * Math.random() | 0 }, He.generateW3CId = function () { for (var e, t = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "a", "b", "c", "d", "e", "f"], i = "", n = 0; n < 4; n++)i += t[15 & (e = He.random32())] + t[e >> 4 & 15] + t[e >> 8 & 15] + t[e >> 12 & 15] + t[e >> 16 & 15] + t[e >> 20 & 15] + t[e >> 24 & 15] + t[e >> 28 & 15]; var r = t[8 + 4 * Math.random() | 0]; return i.substr(0, 8) + i.substr(9, 4) + "4" + i.substr(13, 3) + r + i.substr(16, 3) + i.substr(19, 12) }, He.isArray = function (e) { return "[object Array]" === Object.prototype.toString.call(e) }, He.isError = function (e) { return "[object Error]" === Object.prototype.toString.call(e) }, He.isDate = function (e) { return "[object Date]" === Object.prototype.toString.call(e) }, He.toISOStringForIE8 = function (e) { if (He.isDate(e)) { if (Date.prototype.toISOString) return e.toISOString(); var t = function (e) { var t = String(e); return 1 === t.length && (t = "0" + t), t }; return e.getUTCFullYear() + "-" + t(e.getUTCMonth() + 1) + "-" + t(e.getUTCDate()) + "T" + t(e.getUTCHours()) + ":" + t(e.getUTCMinutes()) + ":" + t(e.getUTCSeconds()) + "." + String((e.getUTCMilliseconds() / 1e3).toFixed(3)).slice(2, 5) + "Z" } }, He.getIEVersion = function (e) { void 0 === e && (e = null); var t = e ? e.toLowerCase() : navigator.userAgent.toLowerCase(); return -1 != t.indexOf("msie") ? parseInt(t.split("msie")[1]) : null }, He.msToTimeSpan = function (e) { (isNaN(e) || e < 0) && (e = 0); var t = "" + (e = Math.round(e)) % 1e3, i = "" + Math.floor(e / 1e3) % 60, n = "" + Math.floor(e / 6e4) % 60, r = "" + Math.floor(e / 36e5) % 24, a = Math.floor(e / 864e5); return t = 1 === t.length ? "00" + t : 2 === t.length ? "0" + t : t, i = i.length < 2 ? "0" + i : i, n = n.length < 2 ? "0" + n : n, (0 < a ? a + "." : "") + (r = r.length < 2 ? "0" + r : r) + ":" + n + ":" + i + "." + t }, He.isCrossOriginError = function (e, t, i, n, r) { return ("Script error." === e || "Script error" === e) && !r }, He.dump = function (e) { var t = Object.prototype.toString.call(e), i = JSON.stringify(e); return "[object Error]" === t && (i = "{ stack: '" + e.stack + "', message: '" + e.message + "', name: '" + e.name + "'"), t + i }, He.getExceptionName = function (e) { return "[object Error]" === Object.prototype.toString.call(e) ? e.name : "" }, He.addEventHandler = function (e, t) { if ("undefined" == typeof window || !window || "string" != typeof e || "function" != typeof t) return !1; var i = "on" + e; if (window.addEventListener) window.addEventListener(e, t, !1); else { if (!window.attachEvent) return !1; window.attachEvent(i, t) } return !0 }, He.IsBeaconApiSupported = function () { return "sendBeacon" in navigator && navigator.sendBeacon }, He.getExtension = function (e, t) { for (var i = null, n = 0; !i && n < e.length;)e[n] && e[n].identifier === t && (i = e[n]), n++; return i }, He.document = "undefined" != typeof document ? document : {}, He._canUseLocalStorage = void 0, He._canUseSessionStorage = void 0, He._internalEndpoints = ["https://dc.services.visualstudio.com/v2/track", "https://breeze.aimon.applicationinsights.io/v2/track", "https://dc-int.services.visualstudio.com/v2/track"], He.NotSpecified = "not_specified", He); function He() { } var je = (Fe.parseUrl = function (e) { return Fe.htmlAnchorElement || (Fe.htmlAnchorElement = Fe.document.createElement ? Fe.document.createElement("a") : { host: Fe.parseHost(e) }), Fe.htmlAnchorElement.href = e, Fe.htmlAnchorElement }, Fe.getAbsoluteUrl = function (e) { var t, i = Fe.parseUrl(e); return i && (t = i.href), t }, Fe.getPathName = function (e) { var t, i = Fe.parseUrl(e); return i && (t = i.pathname), t }, Fe.getCompleteUrl = function (e, t) { return e ? e.toUpperCase() + " " + t : t }, Fe.parseHost = function (e) { var t = e.match(/:\/\/(www[0-9]?\.)?(.[^/:]+)/i); return null != t && 2 < t.length && "string" == typeof t[2] && 0 < t[2].length ? t[2] : null }, Fe.document = "undefined" != typeof document ? document : {}, Fe); function Fe() { } var ze = (Ve.canIncludeCorrelationHeader = function (e, t, i) { if (e && e.disableCorrelationHeaders) return !1; if (!t) return !1; var n = je.parseUrl(t).host.toLowerCase(); if (!(e && e.enableCorsCorrelation || n === i)) return !1; var r, a = e && e.correlationHeaderDomains; if (a && (a.forEach(function (e) { var t = new RegExp(e.toLowerCase().replace(/\./g, ".").replace(/\*/g, ".*")); r = r || t.test(n) }), !r)) return !1; var o = e && e.correlationHeaderExcludedDomains; if (!o || 0 == o.length) return !0; for (var s = 0; s < o.length; s++)if (new RegExp(o[s].toLowerCase().replace(/\./g, ".").replace(/\*/g, ".*")).test(n)) return !1; return !0 }, Ve.getCorrelationContext = function (e) { if (e) { var t = Ve.getCorrelationContextValue(e, Pe.requestContextTargetKey); if (t && t !== Ve.correlationIdPrefix) return t } }, Ve.getCorrelationContextValue = function (e, t) { if (e) for (var i = e.split(","), n = 0; n < i.length; ++n) { var r = i[n].split("="); if (2 == r.length && r[0] == t) return r[1] } }, Ve.correlationIdPrefix = "cid-v1:", Ve); function Ve() { } var Be = (Ge.ParseDependencyPath = function (e, t, i, n) { var r, a = n, o = n; if (t && 0 < t.length) { var s = je.parseUrl(t); if (r = s.host, !a) if (null != s.pathname) { var c = 0 === s.pathname.length ? "/" : s.pathname; "/" !== c.charAt(0) && (c = "/" + c), o = s.pathname, a = Le.sanitizeString(e, i ? i + " " + c : c) } else a = Le.sanitizeString(e, t) } else a = r = n; return { target: r, name: a, data: o } }, Ge); function Ge() { } var We = (Xe.Now = "undefined" == typeof window ? function () { return (new Date).getTime() } : window.performance && window.performance.now && window.performance.timing ? function () { return window.performance.now() + window.performance.timing.navigationStart } : function () { return (new Date).getTime() }, Xe.GetDuration = function (e, t) { var i = null; return 0 === e || 0 === t || m.isNullOrUndefined(e) || m.isNullOrUndefined(t) || (i = t - e), i }, Xe); function Xe() { } var Ke = "Microsoft_ApplicationInsights_BypassAjaxInstrumentation", Je = "ProcessLegacy", Ye = "http.method", Qe = function (e, t) { return (Qe = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (e, t) { e.__proto__ = t } || function (e, t) { for (var i in t) t.hasOwnProperty(i) && (e[i] = t[i]) })(e, t) }; function Ze(e, t) { function i() { this.constructor = e } Qe(e, t), e.prototype = null === t ? Object.create(t) : (i.prototype = t.prototype, new i) } var $e, et = function () { return (et = Object.assign || function (e) { for (var t, i = 1, n = arguments.length; i < n; i++)for (var r in t = arguments[i]) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]); return e }).apply(this, arguments) }, tt = (Ze(it, $e = function () { }), it); function it() { return $e.call(this) || this } var nt, rt = (Ze(at, nt = function () { this.ver = 1, this.sampleRate = 100, this.tags = {} }), at); function at(e, t, i) { var n = nt.call(this) || this; return n.name = Le.sanitizeString(e, i) || qe.NotSpecified, n.data = t, n.time = qe.toISOStringForIE8(new Date), n.aiDataContract = { time: g.Required, iKey: g.Required, name: g.Required, sampleRate: function () { return 100 == n.sampleRate ? g.Hidden : g.Required }, tags: g.Required, data: g.Required }, n } function ot() { } var st, ct = (Ze(lt, st = ot), lt); function lt() { var e = st.call(this) || this; return e.ver = 2, e.properties = {}, e.measurements = {}, e } var ut, pt = (Ze(ht, ut = ct), ht.envelopeType = "Microsoft.ApplicationInsights.{0}.Event", ht.dataType = "EventData", ht); function ht(e, t, i, n) { var r = ut.call(this) || this; return r.aiDataContract = { ver: g.Required, name: g.Required, properties: g.Default, measurements: g.Default }, r.name = Le.sanitizeString(e, t) || qe.NotSpecified, r.properties = Le.sanitizeProperties(e, i), r.measurements = Le.sanitizeMeasurements(e, n), r } function dt() { } var gt, ft = (Ze(mt, gt = ot), mt); function mt() { var e = gt.call(this) || this; return e.ver = 2, e.exceptions = [], e.properties = {}, e.measurements = {}, e } function vt() { this.hasFullStack = !0, this.parsedStack = [] } var yt, xt = (Ze(It, yt = ft), It.CreateFromInterface = function (t, e) { var i = e.exceptions && e.exceptions.map(function (e) { return wt.CreateFromInterface(t, e) }); return new It(t, et({}, e, { exceptions: i })) }, It.prototype.toInterface = function () { var e = this, t = e.exceptions, i = e.properties, n = e.measurements, r = e.severityLevel, a = e.ver, o = e.problemGroup, s = e.id, c = e.isManual; return { ver: a, exceptions: t instanceof Array && t.map(function (e) { return e.toInterface() }) || void 0, severityLevel: r, properties: i, measurements: n, problemGroup: o, id: s, isManual: c } }, It.CreateSimpleException = function (e, t, i, n, r, a) { return { exceptions: [{ hasFullStack: !0, message: e, stack: r, typeName: t }] } }, It.envelopeType = "Microsoft.ApplicationInsights.{0}.Exception", It.dataType = "ExceptionData", It); function It(e, t, i, n, r, a) { var o = yt.call(this) || this; return o.aiDataContract = { ver: g.Required, exceptions: g.Required, severityLevel: g.Default, properties: g.Default, measurements: g.Default }, t instanceof Error ? (o.exceptions = [new wt(e, t)], o.properties = Le.sanitizeProperties(e, i), o.measurements = Le.sanitizeMeasurements(e, n), r && (o.severityLevel = r), a && (o.id = a)) : (o.exceptions = t.exceptions, o.properties = t.properties, o.measurements = t.measurements, t.severityLevel && (o.severityLevel = t.severityLevel), t.id && (o.id = t.id), t.problemGroup && (o.problemGroup = t.problemGroup), m.isNullOrUndefined(t.ver) || (o.ver = t.ver), m.isNullOrUndefined(t.isManual) || (o.isManual = t.isManual)), o } var _t, wt = (Ze(bt, _t = vt), bt.prototype.toInterface = function () { var e = this.parsedStack instanceof Array && this.parsedStack.map(function (e) { return e.toInterface() }); return { id: this.id, outerId: this.outerId, typeName: this.typeName, message: this.message, hasFullStack: this.hasFullStack, stack: this.stack, parsedStack: e || void 0 } }, bt.CreateFromInterface = function (e, t) { var i = t.parsedStack instanceof Array && t.parsedStack.map(function (e) { return Dt.CreateFromInterface(e) }) || t.parsedStack; return new bt(e, et({}, t, { parsedStack: i })) }, bt.parseStack = function (e) { var t = void 0; if ("string" == typeof e) { var i = e.split("\n"); t = []; for (var n = 0, r = 0, a = 0; a <= i.length; a++) { var o = i[a]; if (Dt.regex.test(o)) { var s = new Dt(i[a], n++); r += s.sizeInBytes, t.push(s) } } if (32768 < r) for (var c = 0, l = t.length - 1, u = 0, p = c, h = l; c < l;) { if (32768 < (u += t[c].sizeInBytes + t[l].sizeInBytes)) { var d = h - p + 1; t.splice(p, d); break } p = c, h = l, c++ , l-- } } return t }, bt); function bt(e, t) { var i = _t.call(this) || this; if (i.aiDataContract = { id: g.Default, outerId: g.Default, typeName: g.Required, message: g.Required, hasFullStack: g.Default, stack: g.Default, parsedStack: g.Array }, t instanceof Error) { i.typeName = Le.sanitizeString(e, t.name) || qe.NotSpecified, i.message = Le.sanitizeMessage(e, t.message) || qe.NotSpecified; var n = t.stack; i.parsedStack = bt.parseStack(n), i.stack = Le.sanitizeException(e, n), i.hasFullStack = qe.isArray(i.parsedStack) && 0 < i.parsedStack.length } else i.typeName = t.typeName, i.message = t.message, i.stack = t.stack, i.parsedStack = t.parsedStack, i.hasFullStack = t.hasFullStack; return i } var Tt, Dt = (Ze(St, Tt = dt), St.CreateFromInterface = function (e) { return new St(e, null) }, St.prototype.toInterface = function () { return { level: this.level, method: this.method, assembly: this.assembly, fileName: this.fileName, line: this.line } }, St.regex = /^([\s]+at)?(.*?)(\@|\s\(|\s)([^\(\@\n]+):([0-9]+):([0-9]+)(\)?)$/, St.baseSize = 58, St); function St(e, t) { var i = Tt.call(this) || this; if (i.sizeInBytes = 0, i.aiDataContract = { level: g.Required, method: g.Required, assembly: g.Default, fileName: g.Default, line: g.Default }, "string" == typeof e) { var n = e; i.level = t, i.method = "<no_method>", i.assembly = qe.trim(n), i.fileName = "", i.line = 0; var r = n.match(St.regex); r && 5 <= r.length && (i.method = qe.trim(r[2]) || i.method, i.fileName = qe.trim(r[4]), i.line = parseInt(r[5]) || 0) } else i.level = e.level, i.method = e.method, i.assembly = e.assembly, i.fileName = e.fileName, i.line = e.line, i.sizeInBytes = 0; return i.sizeInBytes += i.method.length, i.sizeInBytes += i.fileName.length, i.sizeInBytes += i.assembly.length, i.sizeInBytes += St.baseSize, i.sizeInBytes += i.level.toString().length, i.sizeInBytes += i.line.toString().length, i } var Ct, Et, Nt, At = (Ze(kt, Ct = ot), kt); function kt() { var e = Ct.call(this) || this; return e.ver = 2, e.metrics = [], e.properties = {}, e } (Nt = Et = Et || {})[Nt.Measurement = 0] = "Measurement", Nt[Nt.Aggregation = 1] = "Aggregation"; var Rt, Mt = (Ze(Pt, Rt = function () { this.kind = Et.Measurement }), Pt); function Pt() { var e = null !== Rt && Rt.apply(this, arguments) || this; return e.aiDataContract = { name: g.Required, kind: g.Default, value: g.Required, count: g.Default, min: g.Default, max: g.Default, stdDev: g.Default }, e } var Ut, Lt = (Ze(Ot, Ut = At), Ot.envelopeType = "Microsoft.ApplicationInsights.{0}.Metric", Ot.dataType = "MetricData", Ot); function Ot(e, t, i, n, r, a, o) { var s = Ut.call(this) || this; s.aiDataContract = { ver: g.Required, metrics: g.Required, properties: g.Default }; var c = new Mt; return c.count = 0 < n ? n : void 0, c.max = isNaN(a) || null === a ? void 0 : a, c.min = isNaN(r) || null === r ? void 0 : r, c.name = Le.sanitizeString(e, t) || qe.NotSpecified, c.value = i, s.metrics = [c], s.properties = Le.sanitizeProperties(e, o), s } var qt, Ht = (Ze(jt, qt = ct), jt); function jt() { var e = qt.call(this) || this; return e.ver = 2, e.properties = {}, e.measurements = {}, e } var Ft, zt = (Ze(Vt, Ft = Ht), Vt.envelopeType = "Microsoft.ApplicationInsights.{0}.Pageview", Vt.dataType = "PageviewData", Vt); function Vt(e, t, i, n, r, a, o) { var s = Ft.call(this) || this; return s.aiDataContract = { ver: g.Required, name: g.Default, url: g.Default, duration: g.Default, properties: g.Default, measurements: g.Default, id: g.Default }, s.id = Le.sanitizeId(e, o), s.url = Le.sanitizeUrl(e, i), s.name = Le.sanitizeString(e, t) || qe.NotSpecified, isNaN(n) || (s.duration = qe.msToTimeSpan(n)), s.properties = Le.sanitizeProperties(e, r), s.measurements = Le.sanitizeMeasurements(e, a), s } var Bt, Gt = (Ze(Wt, Bt = ot), Wt); function Wt() { var e = Bt.call(this) || this; return e.ver = 2, e.success = !0, e.properties = {}, e.measurements = {}, e } var Xt, Kt = (Ze(Jt, Xt = Gt), Jt.envelopeType = "Microsoft.ApplicationInsights.{0}.RemoteDependency", Jt.dataType = "RemoteDependencyData", Jt); function Jt(e, t, i, n, r, a, o, s, c, l, u, p) { void 0 === c && (c = "Ajax"); var h = Xt.call(this) || this; h.aiDataContract = { id: g.Required, ver: g.Required, name: g.Default, resultCode: g.Default, duration: g.Default, success: g.Default, data: g.Default, target: g.Default, type: g.Default, properties: g.Default, measurements: g.Default, kind: g.Default, value: g.Default, count: g.Default, min: g.Default, max: g.Default, stdDev: g.Default, dependencyKind: g.Default, dependencySource: g.Default, commandName: g.Default, dependencyTypeName: g.Default }, h.id = t, h.duration = qe.msToTimeSpan(r), h.success = a, h.resultCode = o + "", h.type = Le.sanitizeString(e, c); var d = Be.ParseDependencyPath(e, i, s, n); return h.data = Le.sanitizeUrl(e, n) || d.data, h.target = Le.sanitizeString(e, d.target), l && (h.target = h.target + " | " + l), h.name = Le.sanitizeString(e, d.name), h.properties = Le.sanitizeProperties(e, u), h.measurements = Le.sanitizeMeasurements(e, p), h } var Yt, Qt = (Ze(Zt, Yt = ot), Zt); function Zt() { var e = Yt.call(this) || this; return e.ver = 2, e.properties = {}, e } var $t, ei = (Ze(ti, $t = Qt), ti.envelopeType = "Microsoft.ApplicationInsights.{0}.Message", ti.dataType = "MessageData", ti); function ti(e, t, i, n) { var r = $t.call(this) || this; return r.aiDataContract = { ver: g.Required, message: g.Required, severityLevel: g.Default, properties: g.Default }, t = t || qe.NotSpecified, r.message = Le.sanitizeMessage(e, t), r.properties = Le.sanitizeProperties(e, n), i && (r.severityLevel = i), r } var ii, ni = (Ze(ri, ii = Ht), ri); function ri() { var e = ii.call(this) || this; return e.ver = 2, e.properties = {}, e.measurements = {}, e } var ai, oi = (Ze(si, ai = ni), si.envelopeType = "Microsoft.ApplicationInsights.{0}.PageviewPerformance", si.dataType = "PageviewPerformanceData", si); function si(e, t, i, n, r, a, o) { var s = ai.call(this) || this; return s.aiDataContract = { ver: g.Required, name: g.Default, url: g.Default, duration: g.Default, perfTotal: g.Default, networkConnect: g.Default, sentRequest: g.Default, receivedResponse: g.Default, domProcessing: g.Default, properties: g.Default, measurements: g.Default }, s.url = Le.sanitizeUrl(e, i), s.name = Le.sanitizeString(e, t) || qe.NotSpecified, s.properties = Le.sanitizeProperties(e, r), s.measurements = Le.sanitizeMeasurements(e, a), o && (s.domProcessing = o.domProcessing, s.duration = o.duration, s.networkConnect = o.networkConnect, s.perfTotal = o.perfTotal, s.receivedResponse = o.receivedResponse, s.sentRequest = o.sentRequest), s } var ci, li, ui, pi = (Ze(hi, ci = tt), hi); function hi(e, t) { var i = ci.call(this) || this; return i.aiDataContract = { baseType: g.Required, baseData: g.Required }, i.baseType = e, i.baseData = t, i } (ui = li = li || {})[ui.Verbose = 0] = "Verbose", ui[ui.Information = 1] = "Information", ui[ui.Warning = 2] = "Warning", ui[ui.Error = 3] = "Error", ui[ui.Critical = 4] = "Critical"; var di = (gi.getConfig = function (e, t, i, n) { var r; return void 0 === n && (n = !1), r = i && e.extensionConfig && e.extensionConfig[i] && !m.isNullOrUndefined(e.extensionConfig[i][t]) ? e.extensionConfig[i][t] : e[t], m.isNullOrUndefined(r) ? n : r }, gi); function gi() { } var fi = function () { this.applicationVersion = "ai.application.ver", this.applicationBuild = "ai.application.build", this.applicationTypeId = "ai.application.typeId", this.applicationId = "ai.application.applicationId", this.applicationLayer = "ai.application.layer", this.deviceId = "ai.device.id", this.deviceIp = "ai.device.ip", this.deviceLanguage = "ai.device.language", this.deviceLocale = "ai.device.locale", this.deviceModel = "ai.device.model", this.deviceFriendlyName = "ai.device.friendlyName", this.deviceNetwork = "ai.device.network", this.deviceNetworkName = "ai.device.networkName", this.deviceOEMName = "ai.device.oemName", this.deviceOS = "ai.device.os", this.deviceOSVersion = "ai.device.osVersion", this.deviceRoleInstance = "ai.device.roleInstance", this.deviceRoleName = "ai.device.roleName", this.deviceScreenResolution = "ai.device.screenResolution", this.deviceType = "ai.device.type", this.deviceMachineName = "ai.device.machineName", this.deviceVMName = "ai.device.vmName", this.deviceBrowser = "ai.device.browser", this.deviceBrowserVersion = "ai.device.browserVersion", this.locationIp = "ai.location.ip", this.locationCountry = "ai.location.country", this.locationProvince = "ai.location.province", this.locationCity = "ai.location.city", this.operationId = "ai.operation.id", this.operationName = "ai.operation.name", this.operationParentId = "ai.operation.parentId", this.operationRootId = "ai.operation.rootId", this.operationSyntheticSource = "ai.operation.syntheticSource", this.operationCorrelationVector = "ai.operation.correlationVector", this.sessionId = "ai.session.id", this.sessionIsFirst = "ai.session.isFirst", this.sessionIsNew = "ai.session.isNew", this.userAccountAcquisitionDate = "ai.user.accountAcquisitionDate", this.userAccountId = "ai.user.accountId", this.userAgent = "ai.user.userAgent", this.userId = "ai.user.id", this.userStoreRegion = "ai.user.storeRegion", this.userAuthUserId = "ai.user.authUserId", this.userAnonymousUserAcquisitionDate = "ai.user.anonUserAcquisitionDate", this.userAuthenticatedUserAcquisitionDate = "ai.user.authUserAcquisitionDate", this.cloudName = "ai.cloud.name", this.cloudRole = "ai.cloud.role", this.cloudRoleVer = "ai.cloud.roleVer", this.cloudRoleInstance = "ai.cloud.roleInstance", this.cloudEnvironment = "ai.cloud.environment", this.cloudLocation = "ai.cloud.location", this.cloudDeploymentUnit = "ai.cloud.deploymentUnit", this.internalNodeName = "ai.internal.nodeName", this.internalSdkVersion = "ai.internal.sdkVersion", this.internalAgentVersion = "ai.internal.agentVersion" }, mi = (vi.create = function (e, t, i, n, r, a) { if (i = Le.sanitizeString(n, i) || qe.NotSpecified, m.isNullOrUndefined(e) || m.isNullOrUndefined(t) || m.isNullOrUndefined(i)) throw Error("Input doesn't contain all required fields"); var o = { name: i, time: (new Date).toISOString(), iKey: "", ext: a || {}, tags: [], data: {}, baseType: t, baseData: e }; if (!m.isNullOrUndefined(r)) for (var s in r) r.hasOwnProperty(s) && (o.data[s] = r[s]); return o }, vi); function vi() { } var yi = (xi.UserExt = "user", xi.DeviceExt = "device", xi.TraceExt = "trace", xi.WebExt = "web", xi.AppExt = "app", xi.OSExt = "os", xi.SessionExt = "ses", xi.SDKExt = "sdk", xi); function xi() { } var Ii = new fi, _i = "AppInsightsPropertiesPlugin", wi = "AppInsightsChannelPlugin", bi = (Ti.prototype.addTelemetryInitializers = function (e) { var t = this; this._hasLegacyInitializers || (this.appInsightsNew.addTelemetryInitializer(function (e) { t._processLegacyInitializers(e) }), this._hasLegacyInitializers = !0), this._queue.push(e) }, Ti.prototype._processLegacyInitializers = function (e) { return e.tags[Je] = this._queue, e }, Ti.prototype.startTrackPage = function (e) { this.appInsightsNew.startTrackPage(e) }, Ti.prototype.stopTrackPage = function (e, t, i, n) { this.appInsightsNew.stopTrackPage(e, t, i) }, Ti.prototype.trackPageView = function (e, t, i, n, r) { var a = { name: e, uri: t, properties: i, measurements: n }; this.appInsightsNew.trackPageView(a) }, Ti.prototype.trackEvent = function (e, t, i) { this.appInsightsNew.trackEvent({ name: e }) }, Ti.prototype.trackDependency = function (e, t, i, n, r, a, o) { this.appInsightsNew.trackDependencyData({ id: e, target: i, type: n, duration: r, properties: { HttpMethod: t }, success: a, responseCode: o }) }, Ti.prototype.trackException = function (e, t, i, n, r) { this.appInsightsNew.trackException({ exception: e }) }, Ti.prototype.trackMetric = function (e, t, i, n, r, a) { this.appInsightsNew.trackMetric({ name: e, average: t, sampleCount: i, min: n, max: r }) }, Ti.prototype.trackTrace = function (e, t, i) { this.appInsightsNew.trackTrace({ message: e, severityLevel: i }) }, Ti.prototype.flush = function (e) { this.appInsightsNew.flush(e) }, Ti.prototype.setAuthenticatedUserContext = function (e, t, i) { this.appInsightsNew.context.user.setAuthenticatedUserContext(e, t, i) }, Ti.prototype.clearAuthenticatedUserContext = function () { this.appInsightsNew.context.user.clearAuthenticatedUserContext() }, Ti.prototype._onerror = function (e, t, i, n, r) { this.appInsightsNew._onerror({ message: e, url: t, lineNumber: i, columnNumber: n, error: r }) }, Ti.prototype.startTrackEvent = function (e) { this.appInsightsNew.startTrackEvent(e) }, Ti.prototype.stopTrackEvent = function (e, t, i) { this.appInsightsNew.stopTrackEvent(e, t, i) }, Ti.prototype.downloadAndSetup = function (e) { throw new Error("downloadAndSetup not implemented in web SKU") }, Ti.prototype.updateSnippetDefinitions = function (e) { for (var t in this) "string" == typeof t && (e[t] = this[t]) }, Ti.prototype.loadAppInsights = function () { var n = this; if (this.config.iKey) { var r = this.trackPageView; this.trackPageView = function (e, t, i) { r.apply(n, [null, e, t, i]) } } var e = "logPageView"; "function" == typeof this.snippet[e] && (this[e] = function (e, t, i) { n.trackPageView(null, e, t, i) }); var t = "logEvent"; return "function" == typeof this.snippet[t] && (this[t] = function (e, t, i) { n.trackEvent(e, t, i) }), this }, Ti.getDefaultConfig = function (e) { return (e = e || {}).endpointUrl = e.endpointUrl || "https://dc.services.visualstudio.com/v2/track", e.sessionRenewalMs = 18e5, e.sessionExpirationMs = 864e5, e.maxBatchSizeInBytes = 0 < e.maxBatchSizeInBytes ? e.maxBatchSizeInBytes : 102400, e.maxBatchInterval = isNaN(e.maxBatchInterval) ? 15e3 : e.maxBatchInterval, e.enableDebug = qe.stringToBoolOrDefault(e.enableDebug), e.disableExceptionTracking = qe.stringToBoolOrDefault(e.disableExceptionTracking), e.disableTelemetry = qe.stringToBoolOrDefault(e.disableTelemetry), e.verboseLogging = qe.stringToBoolOrDefault(e.verboseLogging), e.emitLineDelimitedJson = qe.stringToBoolOrDefault(e.emitLineDelimitedJson), e.diagnosticLogInterval = e.diagnosticLogInterval || 1e4, e.autoTrackPageVisitTime = qe.stringToBoolOrDefault(e.autoTrackPageVisitTime), (isNaN(e.samplingPercentage) || e.samplingPercentage <= 0 || 100 <= e.samplingPercentage) && (e.samplingPercentage = 100), e.disableAjaxTracking = qe.stringToBoolOrDefault(e.disableAjaxTracking), e.maxAjaxCallsPerView = isNaN(e.maxAjaxCallsPerView) ? 500 : e.maxAjaxCallsPerView, e.isBeaconApiDisabled = qe.stringToBoolOrDefault(e.isBeaconApiDisabled, !0), e.disableCorrelationHeaders = qe.stringToBoolOrDefault(e.disableCorrelationHeaders), e.correlationHeaderExcludedDomains = e.correlationHeaderExcludedDomains || ["*.blob.core.windows.net", "*.blob.core.chinacloudapi.cn", "*.blob.core.cloudapi.de", "*.blob.core.usgovcloudapi.net"], e.disableFlushOnBeforeUnload = qe.stringToBoolOrDefault(e.disableFlushOnBeforeUnload), e.enableSessionStorageBuffer = qe.stringToBoolOrDefault(e.enableSessionStorageBuffer, !0), e.isRetryDisabled = qe.stringToBoolOrDefault(e.isRetryDisabled), e.isCookieUseDisabled = qe.stringToBoolOrDefault(e.isCookieUseDisabled), e.isStorageUseDisabled = qe.stringToBoolOrDefault(e.isStorageUseDisabled), e.isBrowserLinkTrackingEnabled = qe.stringToBoolOrDefault(e.isBrowserLinkTrackingEnabled), e.enableCorsCorrelation = qe.stringToBoolOrDefault(e.enableCorsCorrelation), e }, Ti); function Ti(e, t) { this._hasLegacyInitializers = !1, this._queue = [], this.config = Ti.getDefaultConfig(e.config), this.appInsightsNew = t, this.context = { addTelemetryInitializer: this.addTelemetryInitializers.bind(this) } } var Di = (Si.prototype.trackPageView = function (t, i) { var n = this, r = t.name; !m.isNullOrUndefined(r) && "string" == typeof r || (t.name = window.document && window.document.title || ""); var a = t.uri; if (!m.isNullOrUndefined(a) && "string" == typeof a || (t.uri = window.location && window.location.href || ""), !this._pageViewPerformanceManager.isPerformanceTimingSupported()) return this.appInsights.sendPageViewInternal(t, i), this._channel().forEach(function (e) { e.forEach(function (e) { return e.flush(!0) }) }), void this._logger.throwInternal(v.WARNING, H, "trackPageView: navigation timing API used for calculation of page duration is not supported in this browser. This page view will be collected without duration and timing info."); var o = !1, s = void 0, c = this._pageViewPerformanceManager.getPerformanceTiming().navigationStart; s = We.GetDuration(c, +new Date), this._pageViewPerformanceManager.shouldCollectDuration(s) || (s = void 0); var e = void 0; m.isNullOrUndefined(i) || m.isNullOrUndefined(i.duration) || (e = i.duration), !this.overridePageViewDuration && isNaN(e) || (isNaN(e) && ((i = i || {}).duration = s), this.appInsights.sendPageViewInternal(t, i), this._channel().forEach(function (e) { e.forEach(function (e) { return e.flush(!0) }) }), o = !0), i = i || {}; var l = setInterval(function () { try { if (n._pageViewPerformanceManager.isPerformanceTimingDataReady()) { clearInterval(l); var e = { name: r, uri: a }; n._pageViewPerformanceManager.populatePageViewPerformanceEvent(e), e.isValid || o ? (o || (i.duration = e.durationMs, n.appInsights.sendPageViewInternal(t, i)), n.pageViewPerformanceSent || (n.appInsights.sendPageViewPerformanceInternal(e, i), n.pageViewPerformanceSent = !0), n._channel().forEach(function (e) { e.forEach(function (e) { return e.flush(!0) }) })) : (i.duration = s, n.appInsights.sendPageViewInternal(t, i), n._channel().forEach(function (e) { e.forEach(function (e) { return e.flush(!0) }) })) } else 6e4 < We.GetDuration(c, +new Date) && (clearInterval(l), o || (i.duration = 6e4, n.appInsights.sendPageViewInternal(t, i), n._channel().forEach(function (e) { e.forEach(function (e) { return e.flush(!0) }) }))) } catch (e) { n._logger.throwInternal(v.CRITICAL, Q, "trackPageView failed on page load calculation: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, 100) }, Si); function Si(e, t, i, n) { this.pageViewPerformanceSent = !1, this.overridePageViewDuration = !1, this.overridePageViewDuration = t, this.appInsights = e, this._pageViewPerformanceManager = n, i && (this._channel = function () { return i.getTransmissionControls() }, this._logger = i.logger) } var Ci = (Ei.prototype.trackPreviousPageVisit = function (e, t) { try { var i = this.restartPageVisitTimer(e, t); i && this.pageVisitTimeTrackingHandler(i.pageName, i.pageUrl, i.pageVisitTime) } catch (e) { this._logger.warnToConsole("Auto track page visit time failed, metric will not be collected: " + qe.dump(e)) } }, Ei.prototype.restartPageVisitTimer = function (e, t) { try { var i = this.stopPageVisitTimer(); return this.startPageVisitTimer(e, t), i } catch (e) { return this._logger.warnToConsole("Call to restart failed: " + qe.dump(e)), null } }, Ei.prototype.startPageVisitTimer = function (e, t) { try { if (qe.canUseSessionStorage()) { if (null != qe.getSessionStorage(this._logger, this.prevPageVisitDataKeyName)) throw new Error("Cannot call startPageVisit consecutively without first calling stopPageVisit"); var i = new Ni(e, t), n = JSON.stringify(i); qe.setSessionStorage(this._logger, this.prevPageVisitDataKeyName, n) } } catch (e) { this._logger.warnToConsole("Call to start failed: " + qe.dump(e)) } }, Ei.prototype.stopPageVisitTimer = function () { try { if (qe.canUseSessionStorage()) { var e = Date.now(), t = qe.getSessionStorage(this._logger, this.prevPageVisitDataKeyName); if (t) { var i = JSON.parse(t); return i.pageVisitTime = e - i.pageVisitStartTime, qe.removeSessionStorage(this._logger, this.prevPageVisitDataKeyName), i } return null } return null } catch (e) { return this._logger.warnToConsole("Stop page visit timer failed: " + qe.dump(e)), null } }, Ei); function Ei(e, t) { this.prevPageVisitDataKeyName = "prevPageVisitData", this.pageVisitTimeTrackingHandler = t, this._logger = e } var Ni = function (e, t) { this.pageVisitStartTime = Date.now(), this.pageName = e, this.pageUrl = t }, Ai = (ki.prototype.populatePageViewPerformanceEvent = function (e) { e.isValid = !1; var t = this.getPerformanceTiming(); if (t) { var i = We.GetDuration(t.navigationStart, t.loadEventEnd), n = We.GetDuration(t.navigationStart, t.connectEnd), r = We.GetDuration(t.requestStart, t.responseStart), a = We.GetDuration(t.responseStart, t.responseEnd), o = We.GetDuration(t.responseEnd, t.loadEventEnd); 0 == i ? this._logger.throwInternal(v.WARNING, D, "error calculating page view performance.", { total: i, network: n, request: r, response: a, dom: o }) : this.shouldCollectDuration(i, n, r, a, o) ? i < Math.floor(n) + Math.floor(r) + Math.floor(a) + Math.floor(o) ? this._logger.throwInternal(v.WARNING, b, "client performance math error.", { total: i, network: n, request: r, response: a, dom: o }) : (e.durationMs = i, e.perfTotal = e.duration = qe.msToTimeSpan(i), e.networkConnect = qe.msToTimeSpan(n), e.sentRequest = qe.msToTimeSpan(r), e.receivedResponse = qe.msToTimeSpan(a), e.domProcessing = qe.msToTimeSpan(o), e.isValid = !0) : this._logger.throwInternal(v.WARNING, ne, "Invalid page load duration value. Browser perf data won't be sent.", { total: i, network: n, request: r, response: a, dom: o }) } }, ki.prototype.getPerformanceTiming = function () { return this.isPerformanceTimingSupported() ? window.performance.timing : null }, ki.prototype.isPerformanceTimingSupported = function () { return "undefined" != typeof window && window.performance && window.performance.timing }, ki.prototype.isPerformanceTimingDataReady = function () { var e = window.performance.timing; return 0 < e.domainLookupStart && 0 < e.navigationStart && 0 < e.responseStart && 0 < e.requestStart && 0 < e.loadEventEnd && 0 < e.responseEnd && 0 < e.connectEnd && 0 < e.domLoading }, ki.prototype.shouldCollectDuration = function () { for (var e = [], t = 0; t < arguments.length; t++)e[t] = arguments[t]; var i = ["googlebot", "adsbot-google", "apis-google", "mediapartners-google"], n = navigator.userAgent, r = !1; if (n) for (var a = 0; a < i.length; a++)r = r || -1 !== n.toLowerCase().indexOf(i[a]); if (r) return !1; for (var o = 0; o < e.length; o++)if (e[o] >= this.MAX_DURATION_ALLOWED) return !1; return !0 }, ki); function ki(e) { this.MAX_DURATION_ALLOWED = 36e5, e && (this._logger = e.logger) } var Ri = "duration", Mi = (Pi.getDefaultConfig = function (e) { return (e = e || {}).sessionRenewalMs = 18e5, e.sessionExpirationMs = 864e5, e.disableExceptionTracking = qe.stringToBoolOrDefault(e.disableExceptionTracking), e.autoTrackPageVisitTime = qe.stringToBoolOrDefault(e.autoTrackPageVisitTime), e.overridePageViewDuration = qe.stringToBoolOrDefault(e.overridePageViewDuration), (isNaN(e.samplingPercentage) || e.samplingPercentage <= 0 || 100 <= e.samplingPercentage) && (e.samplingPercentage = 100), e.isCookieUseDisabled = qe.stringToBoolOrDefault(e.isCookieUseDisabled), e.isStorageUseDisabled = qe.stringToBoolOrDefault(e.isStorageUseDisabled), e.isBrowserLinkTrackingEnabled = qe.stringToBoolOrDefault(e.isBrowserLinkTrackingEnabled), e.enableAutoRouteTracking = qe.stringToBoolOrDefault(e.enableAutoRouteTracking), e.namePrefix = e.namePrefix || "", e }, Pi.prototype.processTelemetry = function (e) { for (var t = !1, i = this._telemetryInitializers.length, n = 0; n < i; ++n) { var r = this._telemetryInitializers[n]; if (r) try { if (!1 === r.apply(null, [e])) { t = !0; break } } catch (e) { this._logger.throwInternal(v.CRITICAL, xe, "One of telemetry initializers failed, telemetry item will not be sent: " + qe.getExceptionName(e), { exception: qe.dump(e) }, !0) } } t || m.isNullOrUndefined(this._nextPlugin) || this._nextPlugin.processTelemetry(e) }, Pi.prototype.setNextPlugin = function (e) { this._nextPlugin = e }, Pi.prototype.trackEvent = function (e, t) { try { var i = mi.create(e, pt.dataType, pt.envelopeType, this._logger, t); this.core.track(i) } catch (e) { this._logger.throwInternal(v.WARNING, Z, "trackTrace failed, trace will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.startTrackEvent = function (e) { try { this._eventTracking.start(e) } catch (e) { this._logger.throwInternal(v.CRITICAL, V, "startTrackEvent failed, event will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.stopTrackEvent = function (e, t, i) { try { this._eventTracking.stop(e, void 0, t) } catch (e) { this._logger.throwInternal(v.CRITICAL, B, "stopTrackEvent failed, event will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.trackTrace = function (e, t) { try { var i = mi.create(e, ei.dataType, ei.envelopeType, this._logger, t); this.core.track(i) } catch (e) { this._logger.throwInternal(v.WARNING, Z, "trackTrace failed, trace will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.trackMetric = function (e, t) { try { var i = mi.create(e, Lt.dataType, Lt.envelopeType, this._logger, t); this.core.track(i) } catch (e) { this._logger.throwInternal(v.CRITICAL, J, "trackMetric failed, metric will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.trackPageView = function (e, t) { try { var i = e || {}; this._pageViewManager.trackPageView(i, et({}, i.properties, i.measurements, t)), this.config.autoTrackPageVisitTime && this._pageVisitTimeManager.trackPreviousPageVisit(i.name, i.uri) } catch (e) { this._logger.throwInternal(v.CRITICAL, Y, "trackPageView failed, page view will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.sendPageViewInternal = function (e, t, i) { "undefined" != typeof document && (e.refUri = void 0 === e.refUri ? document.referrer : e.refUri); var n = mi.create(e, zt.dataType, zt.envelopeType, this._logger, t, i); this.core.track(n), this._trackAjaxAttempts = 0 }, Pi.prototype.sendPageViewPerformanceInternal = function (e, t, i) { var n = mi.create(e, oi.dataType, oi.envelopeType, this._logger, t, i); this.core.track(n) }, Pi.prototype.trackPageViewPerformance = function (e, t) { try { this._pageViewPerformanceManager.populatePageViewPerformanceEvent(e), this.sendPageViewPerformanceInternal(e, t) } catch (e) { this._logger.throwInternal(v.CRITICAL, Y, "trackPageViewPerformance failed, page view will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.startTrackPage = function (e) { try { "string" != typeof e && (e = window.document && window.document.title || ""), this._pageTracking.start(e) } catch (e) { this._logger.throwInternal(v.CRITICAL, G, "startTrackPage failed, page view may not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.stopTrackPage = function (e, t, i, n) { try { "string" != typeof e && (e = window.document && window.document.title || ""), "string" != typeof t && (t = window.location && window.location.href || ""), this._pageTracking.stop(e, t, i, n), this.config.autoTrackPageVisitTime && this._pageVisitTimeManager.trackPreviousPageVisit(e, t) } catch (e) { this._logger.throwInternal(v.CRITICAL, W, "stopTrackPage failed, page view will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype.sendExceptionInternal = function (e, t, i) { var n = new xt(this._logger, e.exception || new Error(qe.NotSpecified), e.properties, e.measurements, e.severityLevel, e.id).toInterface(), r = mi.create(n, xt.dataType, xt.envelopeType, this._logger, t, i); this.core.track(r) }, Pi.prototype.trackException = function (e, t) { try { this.sendExceptionInternal(e, t) } catch (e) { this._logger.throwInternal(v.CRITICAL, K, "trackException failed, exception will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, Pi.prototype._onerror = function (t) { try { var e = { url: t && t.url || document.URL, lineNumber: t.lineNumber, columnNumber: t.columnNumber, message: t.message }; if (qe.isCrossOriginError(t.message, t.url, t.lineNumber, t.columnNumber, t.error)) this._sendCORSException(e.url); else { if (!qe.isError(t.error)) { var i = "window.onerror@" + e.url + ":" + t.lineNumber + ":" + (t.columnNumber || 0); t.error = new Error(t.message), t.error.stack = i } this.trackException({ exception: t.error, severityLevel: li.Error }, e) } } catch (e) { var n = t.error ? t.error.name + ", " + t.error.message : "null"; this._logger.throwInternal(v.CRITICAL, S, "_onError threw exception while logging error, error will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e), errorString: n }) } }, Pi.prototype.addTelemetryInitializer = function (e) { this._telemetryInitializers.push(e) }, Pi.prototype._initialize = function (e, t, i) { var o = this; if (!this._isInitialized) { if (m.isNullOrUndefined(t)) throw Error("Error initializing"); this.core = t, this._logger = t.logger, this._globalconfig = { instrumentationKey: e.instrumentationKey, endpointUrl: e.endpointUrl || "https://dc.services.visualstudio.com/v2/track" }, this.config = e.extensionConfig && e.extensionConfig[this.identifier] ? e.extensionConfig[this.identifier] : {}; var n = Pi.getDefaultConfig(); if (void 0 !== n) { for (var r in n) this.config[r] = di.getConfig(e, r, this.identifier, n[r]); if (this._globalconfig) for (var r in n) void 0 === this._globalconfig[r] && (this._globalconfig[r] = n[r]) } this.config.isCookieUseDisabled && qe.disableCookies(), this.config.isStorageUseDisabled && qe.disableStorage(); var a = { instrumentationKey: function () { return e.instrumentationKey }, accountId: function () { return o.config.accountId || e.accountId }, sessionRenewalMs: function () { return o.config.sessionRenewalMs || e.sessionRenewalMs }, sessionExpirationMs: function () { return o.config.sessionExpirationMs || e.sessionExpirationMs }, sampleRate: function () { return o.config.samplingPercentage || e.samplingPercentage }, cookieDomain: function () { return o.config.cookieDomain || e.cookieDomain }, sdkExtension: function () { return o.config.sdkExtension || e.sdkExtension }, isBrowserLinkTrackingEnabled: function () { return o.config.isBrowserLinkTrackingEnabled || e.isBrowserLinkTrackingEnabled }, appId: function () { return o.config.appId || e.appId } }; this._pageViewPerformanceManager = new Ai(this.core), this._pageViewManager = new Di(this, this.config.overridePageViewDuration, this.core, this._pageViewPerformanceManager), this._pageVisitTimeManager = new Ci(this._logger, function (e, t, i) { return o.trackPageVisitTime(e, t, i) }), this._telemetryInitializers = [], this._addDefaultTelemetryInitializers(a), this._eventTracking = new Ui(this._logger, "trackEvent"), this._eventTracking.action = function (e, t, i, n) { (n = n || {})[Ri] = i.toString(), o.trackEvent({ name: e, properties: n }) }, this._pageTracking = new Ui(this._logger, "trackPageView"), this._pageTracking.action = function (e, t, i, n, r) { m.isNullOrUndefined(n) && (n = {}), n[Ri] = i.toString(); var a = { name: e, uri: t, properties: n, measurements: r }; o.sendPageViewInternal(a) }; var s, c, l = this; if (!1 === this.config.disableExceptionTracking && !this.config.autoExceptionInstrumented) { var u = window.onerror; window.onerror = function (e, t, i, n, r) { var a = u && u(e, t, i, n, r); return !0 !== a && l._onerror({ message: e, url: t, lineNumber: i, columnNumber: n, error: r }), a }, this.config.autoExceptionInstrumented = !0 } if (!0 === this.config.enableAutoRouteTracking && "object" == typeof history && "function" == typeof history.pushState && "function" == typeof history.replaceState && "object" == typeof window && "undefined" != typeof Event) { var p = this; i.forEach(function (e) { e.identifier === _i && (o._properties = e) }), history.pushState = (c = history.pushState, function () { var e = c.apply(this, arguments); return window.dispatchEvent(qe.createDomEvent(p.config.namePrefix + "pushState")), window.dispatchEvent(qe.createDomEvent(p.config.namePrefix + "locationchange")), e }), history.replaceState = (s = history.replaceState, function () { var e = s.apply(this, arguments); return window.dispatchEvent(qe.createDomEvent(p.config.namePrefix + "replaceState")), window.dispatchEvent(qe.createDomEvent(p.config.namePrefix + "locationchange")), e }), window.addEventListener(p.config.namePrefix + "popstate", function () { window.dispatchEvent(qe.createDomEvent(p.config.namePrefix + "locationchange")) }), window.addEventListener(p.config.namePrefix + "locationchange", function () { p._properties && p._properties.context && p._properties.context.telemetryTrace && (p._properties.context.telemetryTrace.traceID = qe.generateW3CId(), p._properties.context.telemetryTrace.name = window.location && window.location.pathname || "_unknown_"), o._currUri && (o._prevUri = o._currUri), o._currUri = window.location && window.location.href || "", setTimeout(function (e) { p.trackPageView({ refUri: e, properties: { duration: 0 } }) }.bind(o, o._prevUri), p.autoRoutePVDelay) }) } this._isInitialized = !0 } }, Pi.prototype.trackPageVisitTime = function (e, t, i) { var n = { PageName: e, PageUrl: t }; this.trackMetric({ name: "PageVisitTime", average: i, max: i, min: i, sampleCount: 1 }, n) }, Pi.prototype._addDefaultTelemetryInitializers = function (e) { if (!e.isBrowserLinkTrackingEnabled()) { var n = ["/browserLinkSignalR/", "/__browserLink/"]; this._addTelemetryInitializer(function (e) { if (e.baseType === Kt.dataType) { var t = e.baseData; if (t) for (var i = 0; i < n.length; i++)if (t.target && 0 <= t.target.indexOf(n[i])) return !1 } return !0 }) } }, Pi.prototype._addTelemetryInitializer = function (e) { this._telemetryInitializers.push(e) }, Pi.prototype._sendCORSException = function (e) { var t = { message: "Script error: The browser's same-origin policy prevents us from getting the details of this exception. Consider using the 'crossorigin' attribute.", url: e, lineNumber: 0, columnNumber: 0, error: void 0 }, i = mi.create(t, xt.dataType, xt.envelopeType, this._logger, { url: e }); this.core.track(i) }, Pi.Version = "2.2.2", Pi); function Pi() { this.identifier = "ApplicationInsightsAnalytics", this.priority = 180, this.autoRoutePVDelay = 500, this._isInitialized = !1, this._trackAjaxAttempts = 0, this._prevUri = "object" == typeof window && window.location && window.location.href || "", this.initialize = this._initialize.bind(this) } var Ui = (Li.prototype.start = function (e) { void 0 !== this._events[e] && this._logger.throwInternal(v.WARNING, ve, "start was called more than once for this event without calling stop.", { name: this._name, key: e }, !0), this._events[e] = +new Date }, Li.prototype.stop = function (e, t, i, n) { var r = this._events[e]; if (isNaN(r)) this._logger.throwInternal(v.WARNING, ye, "stop was called without a corresponding start.", { name: this._name, key: e }, !0); else { var a = +new Date, o = We.GetDuration(r, a); this.action(e, t, o, i, n) } delete this._events[e], this._events[e] = void 0 }, Li); function Li(e, t) { this._name = t, this._events = {}, this._logger = e } var Oi = (qi.prototype.enqueue = function (e) { this._buffer.push(e) }, qi.prototype.count = function () { return this._buffer.length }, qi.prototype.clear = function () { this._buffer.length = 0 }, qi.prototype.getItems = function () { return this._buffer.slice(0) }, qi.prototype.batchPayloads = function (e) { return e && 0 < e.length ? this._config.emitLineDelimitedJson() ? e.join("\n") : "[" + e.join(",") + "]" : null }, qi.prototype.markAsSent = function (e) { this.clear() }, qi.prototype.clearSent = function (e) { }, qi); function qi(e) { this._config = e, this._buffer = [] } var Hi = (ji.prototype.enqueue = function (e) { this._buffer.length >= ji.MAX_BUFFER_SIZE ? this._bufferFullMessageSent || (this._logger.throwInternal(v.WARNING, _e, "Maximum buffer size reached: " + this._buffer.length, !0), this._bufferFullMessageSent = !0) : (this._buffer.push(e), this.setBuffer(ji.BUFFER_KEY, this._buffer)) }, ji.prototype.count = function () { return this._buffer.length }, ji.prototype.clear = function () { this._buffer.length = 0, this.setBuffer(ji.BUFFER_KEY, []), this.setBuffer(ji.SENT_BUFFER_KEY, []), this._bufferFullMessageSent = !1 }, ji.prototype.getItems = function () { return this._buffer.slice(0) }, ji.prototype.batchPayloads = function (e) { return e && 0 < e.length ? this._config.emitLineDelimitedJson() ? e.join("\n") : "[" + e.join(",") + "]" : null }, ji.prototype.markAsSent = function (e) { this._buffer = this.removePayloadsFromBuffer(e, this._buffer), this.setBuffer(ji.BUFFER_KEY, this._buffer); var t = this.getBuffer(ji.SENT_BUFFER_KEY); t instanceof Array && e instanceof Array && ((t = t.concat(e)).length > ji.MAX_BUFFER_SIZE && (this._logger.throwInternal(v.CRITICAL, _e, "Sent buffer reached its maximum size: " + t.length, !0), t.length = ji.MAX_BUFFER_SIZE), this.setBuffer(ji.SENT_BUFFER_KEY, t)) }, ji.prototype.clearSent = function (e) { var t = this.getBuffer(ji.SENT_BUFFER_KEY); t = this.removePayloadsFromBuffer(e, t), this.setBuffer(ji.SENT_BUFFER_KEY, t) }, ji.prototype.removePayloadsFromBuffer = function (e, t) { var i = []; for (var n in t) { var r = !1; for (var a in e) if (e[a] === t[n]) { r = !0; break } r || i.push(t[n]) } return i }, ji.prototype.getBuffer = function (e) { var t = e; try { t = this._config.namePrefix && this._config.namePrefix() ? this._config.namePrefix() + "_" + t : t; var i = qe.getSessionStorage(this._logger, t); if (i) { var n = JSON.parse(i); if (n) return n } } catch (e) { this._logger.throwInternal(v.CRITICAL, te, " storage key: " + t + ", " + qe.getExceptionName(e), { exception: qe.dump(e) }) } return [] }, ji.prototype.setBuffer = function (e, t) { var i = e; try { i = this._config.namePrefix && this._config.namePrefix() ? this._config.namePrefix() + "_" + i : i; var n = JSON.stringify(t); qe.setSessionStorage(this._logger, i, n) } catch (e) { qe.setSessionStorage(this._logger, i, JSON.stringify([])), this._logger.throwInternal(v.WARNING, ee, " storage key: " + i + ", " + qe.getExceptionName(e) + ". Buffer cleared", { exception: qe.dump(e) }) } }, ji.BUFFER_KEY = "AI_buffer", ji.SENT_BUFFER_KEY = "AI_sentBuffer", ji.MAX_BUFFER_SIZE = 2e3, ji); function ji(e, t) { this._bufferFullMessageSent = !1, this._logger = e, this._config = t; var i = this.getBuffer(ji.BUFFER_KEY), n = this.getBuffer(ji.SENT_BUFFER_KEY); this._buffer = i.concat(n), this._buffer.length > ji.MAX_BUFFER_SIZE && (this._buffer.length = ji.MAX_BUFFER_SIZE), this.setBuffer(ji.SENT_BUFFER_KEY, []), this.setBuffer(ji.BUFFER_KEY, this._buffer) } var Fi = (zi.extractProperties = function (e) { var t = null; for (var i in e) if (e.hasOwnProperty(i)) { var n = e[i]; "number" != typeof n && ((t = t || {})[i] = n) } return t }, zi.extractPropsAndMeasurements = function (e, t, i) { if (!m.isNullOrUndefined(e)) for (var n in e) if (e.hasOwnProperty(n)) { var r = e[n]; "number" == typeof r ? i[n] = r : t[n] = "string" == typeof r ? r : JSON.stringify(r) } }, zi.createEnvelope = function (e, t, i, n) { var r = new rt(e, n, t); r.iKey = i.iKey; var a = i.iKey.replace(/-/g, ""); return r.name = r.name.replace("{0}", a), zi.extractPartAExtensions(i, r), i.tags || (i.tags = []), r }, zi.extractPartAExtensions = function (i, e) { if (e.tags || (e.tags = {}), i.ext || (i.ext = {}), i.tags || (i.tags = []), i.ext.user) { i.ext.user.authId && (e.tags[Ii.userAuthUserId] = i.ext.user.authId); var t = i.ext.user.id || i.ext.user.localId; t && (e.tags[Ii.userId] = t) } if (i.ext.app && i.ext.app.sesId && (e.tags[Ii.sessionId] = i.ext.app.sesId), i.ext.device && ((i.ext.device.id || i.ext.device.localId) && (e.tags[Ii.deviceId] = i.ext.device.id || i.ext.device.localId), i.ext.device.deviceClass && (e.tags[Ii.deviceType] = i.ext.device.deviceClass), i.ext.device.ip && (e.tags[Ii.deviceIp] = i.ext.device.ip)), i.ext.web) { var n = i.ext.web; n.browserLang && (e.tags[Ii.deviceLanguage] = n.browserLang), n.browserVer && (e.tags[Ii.deviceBrowserVersion] = n.browserVer), n.browser && (e.tags[Ii.deviceBrowser] = n.browser), e.data = e.data || {}, e.data.baseData = e.data.baseData || {}, e.data.baseData.properties = e.data.baseData.properties || {}, n.domain && (e.data.baseData.properties.domain = n.domain), n.isManual && (e.data.baseData.properties.isManual = n.isManual.toString()), n.screenRes && (e.data.baseData.properties.screenRes = n.screenRes), n.userConsent && (e.data.baseData.properties.userConsent = n.userConsent.toString()) } i.ext.device && i.ext.device.model && (e.tags[Ii.deviceModel] = i.ext.device.model), i.ext.os && i.ext.os.name && (e.tags[Ii.deviceOS] = i.ext.os.name), i.ext.device && i.ext.device.deviceType && (e.tags[Ii.deviceType] = i.ext.device.deviceType), i.ext.trace && (i.ext.trace.parentID && (e.tags[Ii.operationParentId] = i.ext.trace.parentID), i.ext.trace.name && (e.tags[Ii.operationName] = i.ext.trace.name), i.ext.trace.traceID && (e.tags[Ii.operationId] = i.ext.trace.traceID)); for (var r = {}, a = function (e) { var t = i.tags[e]; Object.keys(t).forEach(function (e) { r[e] = t[e] }), i.tags.splice(e, 1) }, o = i.tags.length - 1; 0 <= o; o--)a(o); for (var s in i.tags) r[s] = i.tags[s]; e.tags = et({}, e.tags, r), e.tags[Ii.internalSdkVersion] || (e.tags[Ii.internalSdkVersion] = "javascript:" + zi.Version) }, zi.Version = "2.2.2", zi); function zi() { } var Vi, Bi = (Ze(Gi, Vi = Fi), Gi.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = t.baseData.measurements || {}, n = t.baseData.properties || {}; Fi.extractPropsAndMeasurements(t.data, n, i); var r = t.baseData; if (m.isNullOrUndefined(r)) return e.warnToConsole("Invalid input for dependency data"), null; var a = r.id, o = r.target, s = r.name, c = r.duration, l = r.success, u = r.responseCode, p = r.type, h = r.correlationContext, d = r.properties && r.properties[Ye] ? r.properties[Ye] : "GET", g = new Kt(e, a, o, s, c, l, u, d, p, h, n, i), f = new pi(Kt.dataType, g); return Fi.createEnvelope(e, Kt.envelopeType, t, f) }, Gi.DependencyEnvelopeCreator = new Gi, Gi); function Gi() { return null !== Vi && Vi.apply(this, arguments) || this } var Wi, Xi = (Ze(Ki, Wi = Fi), Ki.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = {}, n = {}; t.baseType !== pt.dataType && (i.baseTypeSource = t.baseType), t.baseType === pt.dataType ? (i = t.baseData.properties || {}, n = t.baseData.measurements || {}) : t.baseData && Fi.extractPropsAndMeasurements(t.baseData, i, n), Fi.extractPropsAndMeasurements(t.data, i, n); var r = t.baseData.name, a = new pt(e, r, i, n), o = new pi(pt.dataType, a); return Fi.createEnvelope(e, pt.envelopeType, t, o) }, Ki.EventEnvelopeCreator = new Ki, Ki); function Ki() { return null !== Wi && Wi.apply(this, arguments) || this } var Ji, Yi = (Ze(Qi, Ji = Fi), Qi.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = t.baseData, n = xt.CreateFromInterface(e, i), r = new pi(xt.dataType, n); return Fi.createEnvelope(e, xt.envelopeType, t, r) }, Qi.ExceptionEnvelopeCreator = new Qi, Qi); function Qi() { return null !== Ji && Ji.apply(this, arguments) || this } var Zi, $i = (Ze(en, Zi = Fi), en.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = t.baseData.properties || {}, n = Fi.extractProperties(t.data); n = et({}, i, n); var r = t.baseData.name, a = t.baseData.average, o = t.baseData.sampleCount, s = t.baseData.min, c = t.baseData.max, l = new Lt(e, r, a, o, s, c, n), u = new pi(Lt.dataType, l); return Fi.createEnvelope(e, Lt.envelopeType, t, u) }, en.MetricEnvelopeCreator = new en, en); function en() { return null !== Zi && Zi.apply(this, arguments) || this } var tn, nn = (Ze(rn, tn = Fi), rn.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = void 0; m.isNullOrUndefined(t.baseData) || m.isNullOrUndefined(t.baseData.properties) || m.isNullOrUndefined(t.baseData.properties.duration) ? m.isNullOrUndefined(t.data) || m.isNullOrUndefined(t.data.duration) || (i = t.data.duration, delete t.data.duration) : (i = t.baseData.properties.duration, delete t.baseData.properties.duration); var n, r = t.baseData; t.ext && t.ext.trace && t.ext.trace.traceID && (n = t.ext.trace.traceID); var a = r.id || n, o = r.name, s = r.uri, c = r.properties || {}, l = r.measurements || {}; if (m.isNullOrUndefined(r.refUri) || (c.refUri = r.refUri), m.isNullOrUndefined(r.pageType) || (c.pageType = r.pageType), m.isNullOrUndefined(r.isLoggedIn) || (c.isLoggedIn = r.isLoggedIn.toString()), !m.isNullOrUndefined(r.properties)) { var u = r.properties; for (var p in u) u.hasOwnProperty(p) && (c[p] = u[p]) } Fi.extractPropsAndMeasurements(t.data, c, l); var h = new zt(e, o, s, i, c, l, a), d = new pi(zt.dataType, h); return Fi.createEnvelope(e, zt.envelopeType, t, d) }, rn.PageViewEnvelopeCreator = new rn, rn); function rn() { return null !== tn && tn.apply(this, arguments) || this } var an, on = (Ze(sn, an = Fi), sn.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = t.baseData, n = i.name, r = i.uri || i.url, a = i.properties || {}, o = i.measurements || {}; Fi.extractPropsAndMeasurements(t.data, a, o); var s = new oi(e, n, r, void 0, a, o, i), c = new pi(oi.dataType, s); return Fi.createEnvelope(e, oi.envelopeType, t, c) }, sn.PageViewPerformanceEnvelopeCreator = new sn, sn); function sn() { return null !== an && an.apply(this, arguments) || this } var cn, ln = (Ze(un, cn = Fi), un.prototype.Create = function (e, t) { this._logger = e, m.isNullOrUndefined(t.baseData) && this._logger.throwInternal(v.CRITICAL, re, "telemetryItem.baseData cannot be null."); var i = t.baseData.message, n = t.baseData.severityLevel, r = Fi.extractProperties(t.data), a = et({}, r, t.baseData.properties), o = new ei(e, i, n, a), s = new pi(ei.dataType, o); return Fi.createEnvelope(e, ei.envelopeType, t, s) }, un.TraceEnvelopeCreator = new un, un); function un() { return null !== cn && cn.apply(this, arguments) || this } var pn = (hn.prototype.serialize = function (e) { var t = this._serializeObject(e, "root"); return JSON.stringify(t) }, hn.prototype._serializeObject = function (e, t) { var i = "__aiCircularRefCheck", n = {}; if (!e) return this._logger.throwInternal(v.CRITICAL, oe, "cannot serialize object because it is null or undefined", { name: t }, !0), n; if (e[i]) return this._logger.throwInternal(v.WARNING, ce, "Circular reference detected while serializing object", { name: t }, !0), n; if (!e.aiDataContract) { if ("measurements" === t) n = this._serializeStringMap(e, "number", t); else if ("properties" === t) n = this._serializeStringMap(e, "string", t); else if ("tags" === t) n = this._serializeStringMap(e, "string", t); else if (qe.isArray(e)) n = this._serializeArray(e, t); else { this._logger.throwInternal(v.WARNING, se, "Attempting to serialize an object which does not implement ISerializable", { name: t }, !0); try { JSON.stringify(e), n = e } catch (e) { this._logger.throwInternal(v.CRITICAL, oe, e && "function" == typeof e.toString ? e.toString() : "Error serializing object", null, !0) } } return n } for (var r in e[i] = !0, e.aiDataContract) { var a, o = e.aiDataContract[r], s = "function" == typeof o ? o() & g.Required : o & g.Required, c = "function" == typeof o ? o() & g.Hidden : o & g.Hidden, l = o & g.Array, u = void 0 !== e[r], p = "object" == typeof e[r] && null !== e[r]; !s || u || l ? c || void 0 !== (a = p ? l ? this._serializeArray(e[r], r) : this._serializeObject(e[r], r) : e[r]) && (n[r] = a) : this._logger.throwInternal(v.CRITICAL, q, "Missing required field specification. The field is required but not present on source", { field: r, name: t }) } return delete e[i], n }, hn.prototype._serializeArray = function (e, t) { var i = void 0; if (e) if (qe.isArray(e)) { i = []; for (var n = 0; n < e.length; n++) { var r = e[n], a = this._serializeObject(r, t + "[" + n + "]"); i.push(a) } } else this._logger.throwInternal(v.CRITICAL, ue, "This field was specified as an array in the contract but the item is not an array.\r\n", { name: t }, !0); return i }, hn.prototype._serializeStringMap = function (e, t, i) { var n = void 0; if (e) for (var r in n = {}, e) { var a = e[r]; if ("string" === t) void 0 === a ? n[r] = "undefined" : null === a ? n[r] = "null" : a.toString ? n[r] = a.toString() : n[r] = "invalid field: toString() is not defined."; else if ("number" === t) if (void 0 === a) n[r] = "undefined"; else if (null === a) n[r] = "null"; else { var o = parseFloat(a); isNaN(o) ? n[r] = "NaN" : n[r] = o } else n[r] = "invalid field: " + i + " is of unknown type.", this._logger.throwInternal(v.CRITICAL, n[r], null, !0) } return n }, hn); function hn(e) { this._logger = e } function dn() { this._onlineStatus = !0; try { "undefined" == typeof window ? this.isListening = !1 : window && window.addEventListener ? (window.addEventListener("online", this._setOnline.bind(this), !1), window.addEventListener("offline", this._setOffline.bind(this), !1), this.isListening = !0) : document && document.body ? (document.body.ononline = this._setOnline.bind(this), document.body.onoffline = this._setOffline.bind(this), this.isListening = !0) : document ? (document.ononline = this._setOnline.bind(this), document.onoffline = this._setOffline.bind(this), this.isListening = !0) : this.isListening = !1 } catch (e) { this.isListening = !1 } } var gn = (dn.prototype._setOnline = function () { this._onlineStatus = !0 }, dn.prototype._setOffline = function () { this._onlineStatus = !1 }, dn.prototype.isOnline = function () { return this.isListening ? this._onlineStatus : !(navigator && !m.isNullOrUndefined(navigator.onLine)) || navigator.onLine }, dn.prototype.isOffline = function () { return !this.isOnline() }, dn.Offline = new dn, dn).Offline, fn = (mn.prototype.getHashCodeScore = function (e) { return this.getHashCode(e) / mn.INT_MAX_VALUE * 100 }, mn.prototype.getHashCode = function (e) { if ("" == e) return 0; for (; e.length < mn.MIN_INPUT_LENGTH;)e = e.concat(e); for (var t = 5381, i = 0; i < e.length; ++i)t = (t << 5) + t + e.charCodeAt(i), t &= t; return Math.abs(t) }, mn.INT_MAX_VALUE = 2147483647, mn.MIN_INPUT_LENGTH = 8, mn); function mn() { } var vn = (yn.prototype.getSamplingScore = function (e) { return e.tags && e.tags[this.keys.userId] ? this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.userId]) : e.ext && e.ext.user && e.ext.user.id ? this.hashCodeGeneragor.getHashCodeScore(e.ext.user.id) : e.tags && e.tags[this.keys.operationId] ? this.hashCodeGeneragor.getHashCodeScore(e.tags[this.keys.operationId]) : e.ext && e.ext.telemetryTrace && e.ext.telemetryTrace.traceID ? this.hashCodeGeneragor.getHashCodeScore(e.ext.telemetryTrace.traceID) : 100 * Math.random() }, yn); function yn() { this.hashCodeGeneragor = new fn, this.keys = new fi } var xn = (In.prototype.isSampledIn = function (e) { var t = this.sampleRate; return null == t || 100 <= t || e.baseType === Lt.dataType || this.samplingScoreGenerator.getSamplingScore(e) < t }, In); function In(e, t) { this.INT_MAX_VALUE = 2147483647, m.isNullOrUndefined(t) ? this._logger = new Ee : this._logger = t, (100 < e || e < 0) && (this._logger.throwInternal(v.WARNING, ge, "Sampling rate is out of range (0..100). Sampling will be disabled, you may be sending too much data which may affect your AI service level.", { samplingRate: e }, !0), this.sampleRate = 100), this.sampleRate = e, this.samplingScoreGenerator = new vn } var _n = (wn.prototype.pause = function () { throw new Error("Method not implemented.") }, wn.prototype.resume = function () { throw new Error("Method not implemented.") }, wn.prototype.flush = function () { try { this.triggerSend() } catch (e) { this._logger.throwInternal(v.CRITICAL, L, "flush failed, telemetry will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, wn.prototype.onunloadFlush = function () { if (!1 !== this._config.onunloadDisableBeacon() && !1 !== this._config.isBeaconApiDisabled() || !qe.IsBeaconApiSupported()) this.flush(); else try { this.triggerSend(!0, this._beaconSender) } catch (e) { this._logger.throwInternal(v.CRITICAL, U, "failed to flush with beacon sender on page unload, telemetry will not be collected: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, wn.prototype.teardown = function () { throw new Error("Method not implemented.") }, wn.prototype.initialize = function (t, e, i) { var n = this; this._logger = e.logger, this._serializer = new pn(e.logger), this._consecutiveErrors = 0, this._retryAt = null, this._lastSend = 0, this._sender = null; var r = wn._getDefaultAppInsightsChannelConfig(); function a(e) { o._config[e] = function () { return di.getConfig(t, e, n.identifier, r[e]()) } } this._config = wn._getEmptyAppInsightsChannelConfig(); var o = this; for (var s in r) a(s); this._buffer = this._config.enableSessionStorageBuffer && qe.canUseSessionStorage() ? new Hi(this._logger, this._config) : new Oi(this._config), this._sample = new xn(this._config.samplingPercentage(), this._logger), !this._config.isBeaconApiDisabled() && qe.IsBeaconApiSupported() ? this._sender = this._beaconSender : "undefined" != typeof XMLHttpRequest && ("withCredentials" in new XMLHttpRequest ? (this._sender = this._xhrSender, this._XMLHttpRequestSupported = !0) : "undefined" != typeof XDomainRequest && (this._sender = this._xdrSender)) }, wn.prototype.processTelemetry = function (e) { var t = this; try { if (this._config.disableTelemetry()) return; if (!e) return void this._logger.throwInternal(v.CRITICAL, w, "Cannot send empty telemetry"); if (e.baseData && !e.baseType) return void this._logger.throwInternal(v.CRITICAL, Te, "Cannot send telemetry without baseData and baseType"); if (e.baseType || (e.baseType = "EventData"), !this._sender) return void this._logger.throwInternal(v.CRITICAL, z, "Sender was not initialized"); if (!this._isSampledIn(e)) return void this._logger.throwInternal(v.WARNING, X, "Telemetry item was sampled out and not sent", { SampleRate: this._sample.sampleRate }); e.tags = e.tags || {}, e.tags.sampleRate = this._sample.sampleRate; var i = wn.constructEnvelope(e, this._config.instrumentationKey(), this._logger); if (!i) return void this._logger.throwInternal(v.CRITICAL, ae, "Unable to create an AppInsights envelope"); var n = !1; if (e.tags && e.tags[Je] && (e.tags[Je].forEach(function (e) { try { e && !1 === e(i) && (n = !0, t._logger.warnToConsole("Telemetry processor check returns false")) } catch (e) { t._logger.throwInternal(v.CRITICAL, xe, "One of telemetry initializers failed, telemetry item will not be sent: " + qe.getExceptionName(e), { exception: qe.dump(e) }, !0) } }), delete e.tags[Je]), n) return; var r = this._serializer.serialize(i), a = this._buffer.getItems(), o = this._buffer.batchPayloads(a); o && o.length + r.length > this._config.maxBatchSizeInBytes() && this.triggerSend(), this._buffer.enqueue(r), this._setupTimer() } catch (e) { this._logger.throwInternal(v.WARNING, C, "Failed adding telemetry to the sender's buffer, some telemetry will be lost: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } m.isNullOrUndefined(this._nextPlugin) || this._nextPlugin.processTelemetry(e) }, wn.prototype.setNextPlugin = function (e) { this._nextPlugin = e }, wn.prototype._xhrReadyStateChange = function (e, t, i) { if (4 === e.readyState) { var n = null; this._appId || (n = this._parseResponse(e.responseText || e.response)) && n.appId && (this._appId = n.appId), (e.status < 200 || 300 <= e.status) && 0 !== e.status ? !this._config.isRetryDisabled() && this._isRetriable(e.status) ? (this._resendPayload(t), this._logger.throwInternal(v.WARNING, $, ". Response code " + e.status + ". Will retry to send " + t.length + " items.")) : this._onError(t, this._formatErrorMessageXhr(e)) : gn.isOffline() ? this._config.isRetryDisabled() || (this._resendPayload(t, 10), this._logger.throwInternal(v.WARNING, $, ". Offline - Response Code: " + e.status + ". Offline status: " + gn.isOffline() + ". Will retry to send " + t.length + " items.")) : 206 === e.status ? (n = n || this._parseResponse(e.responseText || e.response)) && !this._config.isRetryDisabled() ? this._onPartialSuccess(t, n) : this._onError(t, this._formatErrorMessageXhr(e)) : (this._consecutiveErrors = 0, this._onSuccess(t, i)) } }, wn.prototype.triggerSend = function (e, t) { void 0 === e && (e = !0); try { if (this._config.disableTelemetry()) this._buffer.clear(); else { if (0 < this._buffer.count()) { var i = this._buffer.getItems(); t ? t.call(this, i, e) : this._sender(i, e) } this._lastSend = +new Date } clearTimeout(this._timeoutHandle), this._timeoutHandle = null, this._retryAt = null } catch (e) { (!qe.getIEVersion() || 9 < qe.getIEVersion()) && this._logger.throwInternal(v.CRITICAL, $, "Telemetry transmission failed, some telemetry will be lost: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } }, wn.prototype._onError = function (e, t, i) { this._logger.throwInternal(v.WARNING, j, "Failed to send telemetry.", { message: t }), this._buffer.clearSent(e) }, wn.prototype._onPartialSuccess = function (e, t) { for (var i = [], n = [], r = 0, a = t.errors.reverse(); r < a.length; r++) { var o = a[r], s = e.splice(o.index, 1)[0]; this._isRetriable(o.statusCode) ? n.push(s) : i.push(s) } 0 < e.length && this._onSuccess(e, t.itemsAccepted), 0 < i.length && this._onError(i, this._formatErrorMessageXhr(null, ["partial success", t.itemsAccepted, "of", t.itemsReceived].join(" "))), 0 < n.length && (this._resendPayload(n), this._logger.throwInternal(v.WARNING, $, "Partial success. Delivered: " + e.length + ", Failed: " + i.length + ". Will retry to send " + n.length + " our of " + t.itemsReceived + " items")) }, wn.prototype._onSuccess = function (e, t) { this._buffer.clearSent(e) }, wn.prototype._xdrOnLoad = function (e, t) { if (!e || e.responseText + "" != "200" && "" !== e.responseText) { var i = this._parseResponse(e.responseText); i && i.itemsReceived && i.itemsReceived > i.itemsAccepted && !this._config.isRetryDisabled() ? this._onPartialSuccess(t, i) : this._onError(t, this._formatErrorMessageXdr(e)) } else this._consecutiveErrors = 0, this._onSuccess(t, 0) }, wn.constructEnvelope = function (e, t, i) { var n; switch ((n = t === e.iKey || m.isNullOrUndefined(t) ? e : et({}, e, { iKey: t })).baseType) { case pt.dataType: return Xi.EventEnvelopeCreator.Create(i, n); case ei.dataType: return ln.TraceEnvelopeCreator.Create(i, n); case zt.dataType: return nn.PageViewEnvelopeCreator.Create(i, n); case oi.dataType: return on.PageViewPerformanceEnvelopeCreator.Create(i, n); case xt.dataType: return Yi.ExceptionEnvelopeCreator.Create(i, n); case Lt.dataType: return $i.MetricEnvelopeCreator.Create(i, n); case Kt.dataType: return Bi.DependencyEnvelopeCreator.Create(i, n); default: return Xi.EventEnvelopeCreator.Create(i, n) } }, wn._getDefaultAppInsightsChannelConfig = function () { return { endpointUrl: function () { return "https://dc.services.visualstudio.com/v2/track" }, emitLineDelimitedJson: function () { return !1 }, maxBatchInterval: function () { return 15e3 }, maxBatchSizeInBytes: function () { return 102400 }, disableTelemetry: function () { return !1 }, enableSessionStorageBuffer: function () { return !0 }, isRetryDisabled: function () { return !1 }, isBeaconApiDisabled: function () { return !0 }, onunloadDisableBeacon: function () { return !1 }, instrumentationKey: function () { }, namePrefix: function () { }, samplingPercentage: function () { return 100 } } }, wn._getEmptyAppInsightsChannelConfig = function () { return { endpointUrl: void 0, emitLineDelimitedJson: void 0, maxBatchInterval: void 0, maxBatchSizeInBytes: void 0, disableTelemetry: void 0, enableSessionStorageBuffer: void 0, isRetryDisabled: void 0, isBeaconApiDisabled: void 0, onunloadDisableBeacon: void 0, instrumentationKey: void 0, namePrefix: void 0, samplingPercentage: void 0 } }, wn.prototype._isSampledIn = function (e) { return this._sample.isSampledIn(e) }, wn.prototype._beaconSender = function (e, t) { var i = this._config.endpointUrl(), n = this._buffer.batchPayloads(e), r = new Blob([n], { type: "text/plain;charset=UTF-8" }); navigator.sendBeacon(i, r) ? (this._buffer.markAsSent(e), this._onSuccess(e, e.length)) : (this._xhrSender(e, !0), this._logger.throwInternal(v.WARNING, $, ". Failed to send telemetry with Beacon API, retried with xhrSender.")) }, wn.prototype._xhrSender = function (t, e) { var i = this, n = new XMLHttpRequest; n[Ke] = !0, n.open("POST", this._config.endpointUrl(), e), n.setRequestHeader("Content-type", "application/json"), qe.isInternalApplicationInsightsEndpoint(this._config.endpointUrl()) && n.setRequestHeader(Pe.sdkContextHeader, Pe.sdkContextHeaderAppIdRequest), n.onreadystatechange = function () { return i._xhrReadyStateChange(n, t, t.length) }, n.onerror = function (e) { return i._onError(t, i._formatErrorMessageXhr(n), e) }; var r = this._buffer.batchPayloads(t); n.send(r), this._buffer.markAsSent(t) }, wn.prototype._parseResponse = function (t) { try { if (t && "" !== t) { var e = JSON.parse(t); if (e && e.itemsReceived && e.itemsReceived >= e.itemsAccepted && e.itemsReceived - e.itemsAccepted == e.errors.length) return e } } catch (e) { this._logger.throwInternal(v.CRITICAL, ie, "Cannot parse the response. " + qe.getExceptionName(e), { response: t }) } return null }, wn.prototype._resendPayload = function (e, t) { if (void 0 === t && (t = 1), e && 0 !== e.length) { this._buffer.clearSent(e), this._consecutiveErrors++; for (var i = 0, n = e; i < n.length; i++) { var r = n[i]; this._buffer.enqueue(r) } this._setRetryTime(t), this._setupTimer() } }, wn.prototype._setRetryTime = function (e) { var t; if (this._consecutiveErrors <= 1) t = 10; else { var i = (Math.pow(2, this._consecutiveErrors) - 1) / 2, n = Math.floor(Math.random() * i * 10) + 1; n *= e, t = Math.max(Math.min(n, 3600), 10) } var r = Date.now() + 1e3 * t; this._retryAt = r }, wn.prototype._setupTimer = function () { var e = this; if (!this._timeoutHandle) { var t = this._retryAt ? Math.max(0, this._retryAt - Date.now()) : 0, i = Math.max(this._config.maxBatchInterval(), t); this._timeoutHandle = setTimeout(function () { e.triggerSend() }, i) } }, wn.prototype._isRetriable = function (e) { return 408 == e || 429 == e || 500 == e || 503 == e }, wn.prototype._formatErrorMessageXhr = function (e, t) { return e ? "XMLHttpRequest,Status:" + e.status + ",Response:" + e.responseText || e.response || "" : t }, wn.prototype._xdrSender = function (t, e) { var i = this, n = new XDomainRequest; n.onload = function () { return i._xdrOnLoad(n, t) }, n.onerror = function (e) { return i._onError(t, i._formatErrorMessageXdr(n), e) }; var r = window.location && window.location.protocol; if (0 !== this._config.endpointUrl().lastIndexOf(r, 0)) return this._logger.throwInternal(v.WARNING, $, ". Cannot send XDomain request. The endpoint URL protocol doesn't match the hosting page protocol."), void this._buffer.clear(); var a = this._config.endpointUrl().replace(/^(https?:)/, ""); n.open("POST", a); var o = this._buffer.batchPayloads(t); n.send(o), this._buffer.markAsSent(t) }, wn.prototype._formatErrorMessageXdr = function (e, t) { return e ? "XDomainRequest,Response:" + e.responseText || "" : t }, wn); function wn() { this.priority = 1001, this.identifier = wi, this._XMLHttpRequestSupported = !1 } var bn = function () { }, Tn = (Dn.prototype.update = function () { this.automaticSession.id || this.initializeAutomaticSession(); var e = We.Now(), t = e - this.automaticSession.acquisitionDate > this.config.sessionExpirationMs(), i = e - this.automaticSession.renewalDate > this.config.sessionRenewalMs(); t || i ? this.renew() : (!this.cookieUpdatedTimestamp || e - this.cookieUpdatedTimestamp > Dn.cookieUpdateInterval) && (this.automaticSession.renewalDate = e, this.setCookie(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate)) }, Dn.prototype.backup = function () { this.setStorage(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate) }, Dn.prototype.initializeAutomaticSession = function () { var e = qe.getCookie(this._logger, this._storageNamePrefix()); if (e && "function" == typeof e.split) this.initializeAutomaticSessionWithData(e); else { var t = qe.getStorage(this._logger, this._storageNamePrefix()); t && this.initializeAutomaticSessionWithData(t) } this.automaticSession.id || this.renew() }, Dn.prototype.initializeAutomaticSessionWithData = function (e) { var t = e.split("|"); 0 < t.length && (this.automaticSession.id = t[0]); try { if (1 < t.length) { var i = +t[1]; this.automaticSession.acquisitionDate = +new Date(i), this.automaticSession.acquisitionDate = 0 < this.automaticSession.acquisitionDate ? this.automaticSession.acquisitionDate : 0 } if (2 < t.length) { var n = +t[2]; this.automaticSession.renewalDate = +new Date(n), this.automaticSession.renewalDate = 0 < this.automaticSession.renewalDate ? this.automaticSession.renewalDate : 0 } } catch (e) { this._logger.throwInternal(v.CRITICAL, T, "Error parsing ai_session cookie, session will be reset: " + qe.getExceptionName(e), { exception: qe.dump(e) }) } 0 == this.automaticSession.renewalDate && this._logger.throwInternal(v.WARNING, F, "AI session renewal date is 0, session will be reset.") }, Dn.prototype.renew = function () { var e = We.Now(); this.automaticSession.id = qe.newId(), this.automaticSession.acquisitionDate = e, this.automaticSession.renewalDate = e, this.setCookie(this.automaticSession.id, this.automaticSession.acquisitionDate, this.automaticSession.renewalDate), qe.canUseLocalStorage() || this._logger.throwInternal(v.WARNING, h, "Browser does not support local storage. Session durations will be inaccurate.") }, Dn.prototype.setCookie = function (e, t, i) { var n = t + this.config.sessionExpirationMs(), r = i + this.config.sessionRenewalMs(), a = new Date, o = [e, t, i]; n < r ? a.setTime(n) : a.setTime(r); var s = this.config.cookieDomain ? this.config.cookieDomain() : null; qe.setCookie(this._logger, this._storageNamePrefix(), o.join("|") + ";expires=" + a.toUTCString(), s), this.cookieUpdatedTimestamp = We.Now() }, Dn.prototype.setStorage = function (e, t, i) { qe.setStorage(this._logger, this._storageNamePrefix(), [e, t, i].join("|")) }, Dn.acquisitionSpan = 864e5, Dn.renewalSpan = 18e5, Dn.cookieUpdateInterval = 6e4, Dn.cookieNameConst = "ai_session", Dn); function Dn(e, t) { var i = this; m.isNullOrUndefined(t) ? this._logger = new Ee : this._logger = t, "function" != typeof (e = e || {}).sessionExpirationMs && (e.sessionExpirationMs = function () { return Dn.acquisitionSpan }), "function" != typeof e.sessionRenewalMs && (e.sessionRenewalMs = function () { return Dn.renewalSpan }), this.config = e, this._storageNamePrefix = function () { return i.config.namePrefix && i.config.namePrefix() ? Dn.cookieNameConst + i.config.namePrefix() : Dn.cookieNameConst }, this.automaticSession = new bn } var Sn = function () { }, Cn = function () { this.id = "browser", this.deviceClass = "Browser" }, En = function (e) { this.sdkVersion = (e.sdkExtension && e.sdkExtension() ? e.sdkExtension() + "_" : "") + "javascript:2.2.2" }, Nn = (An.prototype.setAuthenticatedUserContext = function (e, t, i) { if (void 0 === i && (i = !1), !this.validateUserInput(e) || t && !this.validateUserInput(t)) this._logger.throwInternal(v.WARNING, fe, "Setting auth user context failed. User auth/account id should be of type string, and not contain commas, semi-colons, equal signs, spaces, or vertical-bars.", !0); else { this.authenticatedId = e; var n = this.authenticatedId; t && (this.accountId = t, n = [this.authenticatedId, this.accountId].join(An.cookieSeparator)), i && qe.setCookie(this._logger, An.authUserCookieName, encodeURI(n), this.config.cookieDomain()) } }, An.prototype.clearAuthenticatedUserContext = function () { this.authenticatedId = null, this.accountId = null, qe.deleteCookie(this._logger, An.authUserCookieName) }, An.prototype.validateUserInput = function (e) { return !("string" != typeof e || !e || e.match(/,|;|=| |\|/)) }, An.cookieSeparator = "|", An.userCookieName = "ai_user", An.authUserCookieName = "ai_authUser", An); function An(e, t) { this._logger = t; var i = qe.getCookie(this._logger, An.userCookieName); if (i) { var n = i.split(An.cookieSeparator); 0 < n.length && (this.id = n[0]) } if (this.config = e, !this.id) { this.id = qe.newId(); var r = new Date, a = qe.toISOStringForIE8(r); this.accountAcquisitionDate = a, r.setTime(r.getTime() + 31536e6); var o = [this.id, a], s = this.config.cookieDomain ? this.config.cookieDomain() : void 0; qe.setCookie(this._logger, An.userCookieName, o.join(An.cookieSeparator) + ";expires=" + r.toUTCString(), s); var c = e.namePrefix && e.namePrefix() ? e.namePrefix() + "ai_session" : "ai_session"; qe.removeStorage(this._logger, c) } this.accountId = e.accountId ? e.accountId() : void 0; var l = qe.getCookie(this._logger, An.authUserCookieName); if (l) { var u = (l = decodeURI(l)).split(An.cookieSeparator); u[0] && (this.authenticatedId = u[0]), 1 < u.length && u[1] && (this.accountId = u[1]) } } var kn = function () { }, Rn = function (e, t, i) { this.traceID = e || qe.generateW3CId(), this.parentID = t, this.name = i, window && window.location && window.location.pathname && (this.name = window.location.pathname) }, Mn = (Pn.prototype.applySessionContext = function (e) { var t = this.session || this.sessionManager.automaticSession; t && "string" == typeof t.id && (e.ext.app.sesId = t.id), this.session && ("string" == typeof this.session.id ? e.ext.app.sesId = this.session.id : e.ext.app.sesId = this.sessionManager.automaticSession.id) }, Pn.prototype.applyOperatingSystemContxt = function (e) { this.os && this.os.name && (e.ext.os = this.os) }, Pn.prototype.applyApplicationContext = function (e) { this.application && ("string" == typeof this.application.ver && (e.tags[Ii.applicationVersion] = this.application.ver), "string" == typeof this.application.build && (e.tags[Ii.applicationBuild] = this.application.build)) }, Pn.prototype.applyDeviceContext = function (e) { this.device && ("string" == typeof this.device.id && (e.ext.device.localId = this.device.id), "string" == typeof this.device.ip && (e.ext.device.ip = this.device.ip), "string" == typeof this.device.model && (e.ext.device.model = this.device.model), "string" == typeof this.device.deviceClass && (e.ext.device.deviceClass = this.device.deviceClass)) }, Pn.prototype.applyInternalContext = function (e) { this.internal && ("string" == typeof this.internal.agentVersion && (e.tags[Ii.internalAgentVersion] = this.internal.agentVersion), "string" == typeof this.internal.sdkVersion && (e.tags[Ii.internalSdkVersion] = this.internal.sdkVersion)) }, Pn.prototype.applyLocationContext = function (e) { this.location && "string" == typeof this.location.ip && (e.tags[Ii.locationIp] = this.location.ip) }, Pn.prototype.applyOperationContext = function (e) { if (this.telemetryTrace) { var t = e.ext.trace || { traceID: void 0, parentID: void 0 }; "string" == typeof this.telemetryTrace.traceID && (t.traceID = this.telemetryTrace.traceID), "string" == typeof this.telemetryTrace.name && (t.name = this.telemetryTrace.name), "string" == typeof this.telemetryTrace.parentID && (t.parentID = this.telemetryTrace.parentID), e.ext.trace = t } }, Pn.prototype.applyWebContext = function (e) { this.web && (e.ext.web = e.ext.web || {}, e.ext.web = this.web) }, Pn.prototype.applyUserContext = function (e) { this.user && (e.tags || (e.tags = []), "string" == typeof this.user.accountId && (e.tags[Ii.userAccountId] = this.user.accountId), "string" == typeof this.user.id && (e.ext.user.id = this.user.id), "string" == typeof this.user.authenticatedId && (e.ext.user.authId = this.user.authenticatedId)) }, Pn.prototype.cleanUp = function (e) { e.ext[yi.DeviceExt] && 0 === Object.keys(e.ext[yi.DeviceExt]).length && delete e.ext[yi.DeviceExt], e.ext[yi.UserExt] && 0 === Object.keys(e.ext[yi.UserExt]).length && delete e.ext[yi.UserExt], e.ext[yi.WebExt] && 0 === Object.keys(e.ext[yi.WebExt]).length && delete e.ext[yi.WebExt], e.ext[yi.OSExt] && 0 === Object.keys(e.ext[yi.OSExt]).length && delete e.ext[yi.OSExt], e.ext[yi.AppExt] && 0 === Object.keys(e.ext[yi.AppExt]).length && delete e.ext[yi.AppExt], e.ext[yi.TraceExt] && 0 === Object.keys(e.ext[yi.TraceExt]).length && delete e.ext[yi.TraceExt] }, Pn); function Pn(e, t) { "undefined" != typeof window && (this.sessionManager = new Tn(t, e), this.application = new Sn, this.device = new Cn, this.internal = new En(t), this.location = new kn, this.user = new Nn(t, e), this.telemetryTrace = new Rn, this.session = new bn), this.appId = function () { return null } } var Un = (Ln.getDefaultConfig = function () { return { instrumentationKey: function () { }, accountId: function () { return null }, sessionRenewalMs: function () { return 18e5 }, samplingPercentage: function () { return 100 }, sessionExpirationMs: function () { return 864e5 }, cookieDomain: function () { return null }, sdkExtension: function () { return null }, isBrowserLinkTrackingEnabled: function () { return !1 }, appId: function () { return null }, namePrefix: function () { } } }, Ln.prototype.initialize = function (t, e, i) { var n = this, r = Ln.getDefaultConfig(); function a(e) { o._extensionConfig[e] = function () { return di.getConfig(t, e, n.identifier, r[e]()) } } this._extensionConfig = this._extensionConfig || Ln.getDefaultConfig(); var o = this; for (var s in r) a(s); this._logger = e.logger, this.context = new Mn(e.logger, this._extensionConfig), this._breezeChannel = qe.getExtension(i, wi), this.context.appId = function () { return n._breezeChannel ? n._breezeChannel._appId : null } }, Ln.prototype.processTelemetry = function (e) { m.isNullOrUndefined(e) || (e.name === zt.envelopeType && this._logger.resetInternalMessageCount(), this.context.session && "string" != typeof this.context.session.id && this.context.sessionManager.update(), this._processTelemetryInternal(e), m.isNullOrUndefined(this._nextPlugin) || this._nextPlugin.processTelemetry(e)) }, Ln.prototype.setNextPlugin = function (e) { this._nextPlugin = e }, Ln.prototype._processTelemetryInternal = function (e) { e.tags || (e.tags = []), e.ext || (e.ext = {}), e.ext[yi.DeviceExt] = e.ext[yi.DeviceExt] || {}, e.ext[yi.WebExt] = e.ext[yi.WebExt] || {}, e.ext[yi.UserExt] = e.ext[yi.UserExt] || {}, e.ext[yi.OSExt] = e.ext[yi.OSExt] || {}, e.ext[yi.AppExt] = e.ext[yi.AppExt] || {}, e.ext[yi.TraceExt] = e.ext[yi.TraceExt] || {}, this.context.applySessionContext(e), this.context.applyApplicationContext(e), this.context.applyDeviceContext(e), this.context.applyOperationContext(e), this.context.applyUserContext(e), this.context.applyOperatingSystemContxt(e), this.context.applyWebContext(e), this.context.applyLocationContext(e), this.context.applyInternalContext(e), this.context.cleanUp(e) }, Ln); function Ln() { this.priority = 110, this.identifier = _i } var On = function () { this.openDone = !1, this.setRequestHeaderDone = !1, this.sendDone = !1, this.abortDone = !1, this.onreadystatechangeCallbackAttached = !1 }, qn = (Hn.prototype.getAbsoluteUrl = function () { return this.requestUrl ? je.getAbsoluteUrl(this.requestUrl) : null }, Hn.prototype.getPathName = function () { return this.requestUrl ? Le.sanitizeUrl(this._logger, je.getCompleteUrl(this.method, this.requestUrl)) : null }, Hn); function Hn(e, t, i) { this.completed = !1, this.requestHeadersSize = null, this.requestHeaders = null, this.ttfb = null, this.responseReceivingDuration = null, this.callbackDuration = null, this.ajaxTotalDuration = null, this.aborted = null, this.pageUrl = null, this.requestUrl = null, this.requestSize = 0, this.method = null, this.status = null, this.requestSentTime = null, this.responseStartedTime = null, this.responseFinishedTime = null, this.callbackFinishedTime = null, this.endTime = null, this.originalOnreadystatechage = null, this.xhrMonitoringState = new On, this.clientFailure = 0, this.CalculateMetrics = function () { this.ajaxTotalDuration = Math.round(1e3 * We.GetDuration(this.requestSentTime, this.responseFinishedTime)) / 1e3 }, this.traceID = e, this.spanID = t, this._logger = i } var jn = (Fn.AttachEvent = function (e, t, i) { var n = !1; return m.isNullOrUndefined(e) || (m.isNullOrUndefined(e.attachEvent) ? m.isNullOrUndefined(e.addEventListener) || (e.addEventListener(t, i, !1), n = !0) : (e.attachEvent("on" + t, i), n = !0)), n }, Fn.DetachEvent = function (e, t, i) { m.isNullOrUndefined(e) || (m.isNullOrUndefined(e.detachEvent) ? m.isNullOrUndefined(e.removeEventListener) || e.removeEventListener(t, i, !1) : e.detachEvent("on" + t, i)) }, Fn); function Fn() { } var zn = (Vn.isValidTraceId = function (e) { return e.match(/^[0-9a-f]{32}$/) && "00000000000000000000000000000000" !== e }, Vn.isValidSpanId = function (e) { return e.match(/^[0-9a-f]{16}$/) && "0000000000000000" !== e }, Vn.prototype.toString = function () { return this.version + "-" + this.traceId + "-" + this.spanId + "-" + this.traceFlag }, Vn.DEFAULT_TRACE_FLAG = "00", Vn.DEFAULT_VERSION = "00", Vn); function Vn(e, t) { this.traceFlag = Vn.DEFAULT_TRACE_FLAG, this.version = Vn.DEFAULT_VERSION, e && Vn.isValidTraceId(e) ? this.traceId = e : this.traceId = qe.generateW3CId(), t && Vn.isValidSpanId(t) ? this.spanId = t : this.spanId = qe.generateW3CId().substr(0, 16) } var Bn = (Gn.prototype.isMonitoredInstance = function (e, t, i, n) { var r = !1, a = !0, o = !1; return void 0 !== i ? (o = this._fetchInitialized, r = "object" == typeof i && !0 === i[Ke] || !!n && !0 === n[Ke]) : void 0 !== e && (o = this.initialized, r = !0 === e[Ke], a = !0 === t || !m.isNullOrUndefined(e.ajaxData)), o && a && !r }, Gn.prototype.supportsAjaxMonitoring = function () { var e = !0; return (m.isNullOrUndefined(XMLHttpRequest) || m.isNullOrUndefined(XMLHttpRequest.prototype) || m.isNullOrUndefined(XMLHttpRequest.prototype.open) || m.isNullOrUndefined(XMLHttpRequest.prototype.send) || m.isNullOrUndefined(XMLHttpRequest.prototype.abort)) && (e = !1), e }, Gn.prototype.instrumentOpen = function () { var n = XMLHttpRequest.prototype.open, r = this; XMLHttpRequest.prototype.open = function (e, t, i) { try { !r.isMonitoredInstance(this, !0) || this.ajaxData && this.ajaxData.xhrMonitoringState.openDone || r.openHandler(this, e, t, i) } catch (e) { r._core.logger.throwInternal(v.CRITICAL, A, "Failed to monitor XMLHttpRequest.open, monitoring data for this ajax call may be incorrect.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(this), exception: qe.dump(e) }) } return n.apply(this, arguments) } }, Gn.prototype.openHandler = function (e, t, i, n) { var r = this._context && this._context.telemetryTrace && this._context.telemetryTrace.traceID || qe.generateW3CId(), a = qe.generateW3CId().substr(0, 16), o = new qn(r, a, this._core.logger); o.method = t, o.requestUrl = i, o.xhrMonitoringState.openDone = !0, o.requestHeaders = {}, e.ajaxData = o, this.attachToOnReadyStateChange(e) }, Gn.getFailedAjaxDiagnosticsMessage = function (e) { var t = ""; try { m.isNullOrUndefined(e) || m.isNullOrUndefined(e.ajaxData) || m.isNullOrUndefined(e.ajaxData.requestUrl) || (t += "(url: '" + e.ajaxData.requestUrl + "')") } catch (e) { } return t }, Gn.prototype.instrumentSend = function () { var t = XMLHttpRequest.prototype.send, i = this; XMLHttpRequest.prototype.send = function (e) { try { i.isMonitoredInstance(this) && !this.ajaxData.xhrMonitoringState.sendDone && i.sendHandler(this, e) } catch (e) { i._core.logger.throwInternal(v.CRITICAL, R, "Failed to monitor XMLHttpRequest, monitoring data for this ajax call may be incorrect.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(this), exception: qe.dump(e) }) } return t.apply(this, arguments) } }, Gn.prototype.sendHandler = function (e, t) { e.ajaxData.requestSentTime = We.Now(), (e = this.includeCorrelationHeaders(e.ajaxData, void 0, void 0, e)).ajaxData.xhrMonitoringState.sendDone = !0 }, Gn.prototype.instrumentAbort = function () { var e = XMLHttpRequest.prototype.abort, t = this; XMLHttpRequest.prototype.abort = function () { try { t.isMonitoredInstance(this) && !this.ajaxData.xhrMonitoringState.abortDone && (this.ajaxData.aborted = 1, this.ajaxData.xhrMonitoringState.abortDone = !0) } catch (e) { t._core.logger.throwInternal(v.CRITICAL, E, "Failed to monitor XMLHttpRequest.abort, monitoring data for this ajax call may be incorrect.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(this), exception: qe.dump(e) }) } return e.apply(this, arguments) } }, Gn.prototype.instrumentSetRequestHeader = function () { if (this._config.enableRequestHeaderTracking) { var i = XMLHttpRequest.prototype.setRequestHeader, n = this; XMLHttpRequest.prototype.setRequestHeader = function (e, t) { try { n.isMonitoredInstance(this) && (this.ajaxData.requestHeaders[e] = t) } catch (e) { n._core.logger.throwInternal(v.CRITICAL, De, "Failed to monitor XMLHttpRequest.setRequestHeader, monitoring data for this ajax call may be incorrect.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(this), exception: qe.dump(e) }) } return i.apply(this, arguments) } } }, Gn.prototype.attachToOnReadyStateChange = function (i) { var n = this; i.ajaxData.xhrMonitoringState.onreadystatechangeCallbackAttached = jn.AttachEvent(i, "readystatechange", function () { try { n.isMonitoredInstance(i) && 4 === i.readyState && n.onAjaxComplete(i) } catch (e) { var t = qe.dump(e); t && -1 != t.toLowerCase().indexOf("c00c023f") || n._core.logger.throwInternal(v.CRITICAL, k, "Failed to monitor XMLHttpRequest 'readystatechange' event handler, monitoring data for this ajax call may be incorrect.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(i), exception: qe.dump(e) }) } }) }, Gn.prototype.onAjaxComplete = function (e) { if (e.ajaxData.responseFinishedTime = We.Now(), e.ajaxData.status = e.status, e.ajaxData.CalculateMetrics(), e.ajaxData.ajaxTotalDuration < 0) this._core.logger.throwInternal(v.WARNING, N, "Failed to calculate the duration of the ajax call, monitoring data for this ajax call won't be sent.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(e), requestSentTime: e.ajaxData.requestSentTime, responseFinishedTime: e.ajaxData.responseFinishedTime }); else { var t = { id: "|" + e.ajaxData.traceID + "." + e.ajaxData.spanID, target: e.ajaxData.getAbsoluteUrl(), name: e.ajaxData.getPathName(), type: "Ajax", duration: e.ajaxData.ajaxTotalDuration, success: 200 <= +e.ajaxData.status && +e.ajaxData.status < 400, responseCode: +e.ajaxData.status, method: e.ajaxData.method }, i = this.getAjaxCorrelationContext(e); if (i && (t.correlationContext = i), this._config.enableRequestHeaderTracking && 0 < Object.keys(e.ajaxData.requestHeaders).length && (t.properties = t.properties || {}, t.properties.requestHeaders = {}, t.properties.requestHeaders = e.ajaxData.requestHeaders), this._config.enableResponseHeaderTracking) { var n = e.getAllResponseHeaders(); if (n) { var r = n.trim().split(/[\r\n]+/), a = {}; r.forEach(function (e) { var t = e.split(": "), i = t.shift(), n = t.join(": "); a[i] = n }), 0 < Object.keys(a).length && (t.properties = t.properties || {}, t.properties.responseHeaders = {}, t.properties.responseHeaders = a) } } this.trackDependencyDataInternal(t), e.ajaxData = null } }, Gn.prototype.getAjaxCorrelationContext = function (t) { try { var e = t.getAllResponseHeaders(); if (null !== e && -1 !== e.toLowerCase().indexOf(Pe.requestContextHeaderLowerCase)) { var i = t.getResponseHeader(Pe.requestContextHeader); return ze.getCorrelationContext(i) } } catch (e) { this._core.logger.throwInternal(v.WARNING, M, "Failed to get Request-Context correlation header as it may be not included in the response or not accessible.", { ajaxDiagnosticsMessage: Gn.getFailedAjaxDiagnosticsMessage(t), exception: qe.dump(e) }) } }, Gn.prototype.trackDependencyDataInternal = function (e, t, i) { if (-1 === this._config.maxAjaxCallsPerView || this._trackAjaxAttempts < this._config.maxAjaxCallsPerView) { var n = mi.create(e, Kt.dataType, Kt.envelopeType, this._core.logger, t, i); this._core.track(n) } else this._trackAjaxAttempts === this._config.maxAjaxCallsPerView && this._core.logger.throwInternal(v.CRITICAL, pe, "Maximum ajax per page view limit reached, ajax monitoring is paused until the next trackPageView(). In order to increase the limit set the maxAjaxCallsPerView configuration parameter.", !0); ++this._trackAjaxAttempts }, Gn.prototype.trackDependencyData = function (e, t) { this.trackDependencyDataInternal(e, t) }, Gn.prototype.processTelemetry = function (e) { this._nextPlugin && this._nextPlugin.processTelemetry && this._nextPlugin.processTelemetry(e) }, Gn.prototype.setNextPlugin = function (e) { e && (this._nextPlugin = e) }, Gn.prototype.instrumentFetch = function () { if (this.supportsFetch() && !this._fetchInitialized) { var n = window.fetch, r = this; window.fetch = function (t, e) { var i; if (r.isFetchInstrumented(t) && r.isMonitoredInstance(void 0, void 0, t, e)) try { i = r.createFetchRecord(t, e), e = r.includeCorrelationHeaders(i, t, e) } catch (e) { r._core.logger.throwInternal(v.CRITICAL, A, "Failed to monitor Window.fetch, monitoring data for this fetch call may be incorrect.", { ajaxDiagnosticsMessage: this.getFailedFetchDiagnosticsMessage(t), exception: qe.dump(e) }) } return n(t, e).then(function (e) { return r.onFetchComplete(e, i), e }).catch(function (e) { throw r.onFetchFailed(t, i, e), e }) }, this._fetchInitialized = !0 } }, Gn.prototype.isFetchInstrumented = function (e) { return this._fetchInitialized && !0 !== e[Ke] }, Gn.prototype.supportsFetch = function () { var e = !0; return (!window || m.isNullOrUndefined(window.Request) || m.isNullOrUndefined(window.Request.prototype) || m.isNullOrUndefined(window.fetch)) && (e = !1), e }, Gn.prototype.createFetchRecord = function (e, t) { var i = this._context && this._context.telemetryTrace && this._context.telemetryTrace.traceID || qe.generateW3CId(), n = qe.generateW3CId().substr(0, 16), r = new qn(i, n, this._core.logger); return r.requestSentTime = We.Now(), e instanceof Request ? r.requestUrl = e ? e.url : "" : r.requestUrl = e, t && t.method ? r.method = t.method : e && e instanceof Request ? r.method = e.method : r.method = "GET", t && t.headers && this._config.enableRequestHeaderTracking ? r.requestHeaders = t.headers : r.requestHeaders = {}, r }, Gn.prototype.includeCorrelationHeaders = function (e, t, i, n) { if (t) { if (ze.canIncludeCorrelationHeader(this._config, e.getAbsoluteUrl(), this.currentWindowHost)) { if ((i = i || {}).headers = new Headers(i.headers || t instanceof Request && t.headers || {}), this._isUsingAIHeaders) { var r = "|" + e.traceID + "." + e.spanID; i.headers.set(Pe.requestIdHeader, r), this._config.enableRequestHeaderTracking && (e.requestHeaders[Pe.requestIdHeader] = r) } var a = this._config.appId || this._context.appId(); if (a && (i.headers.set(Pe.requestContextHeader, Pe.requestContextAppIdFormat + a), this._config.enableRequestHeaderTracking && (e.requestHeaders[Pe.requestContextHeader] = Pe.requestContextAppIdFormat + a)), this._isUsingW3CHeaders) { var o = new zn(e.traceID, e.spanID); i.headers.set(Pe.traceParentHeader, o.toString()), this._config.enableRequestHeaderTracking && (e.requestHeaders[Pe.traceParentHeader] = o.toString()) } return i } return i } if (n) { if (this.currentWindowHost && ze.canIncludeCorrelationHeader(this._config, n.ajaxData.getAbsoluteUrl(), this.currentWindowHost)) { this._isUsingAIHeaders && (r = "|" + n.ajaxData.traceID + "." + n.ajaxData.spanID, n.setRequestHeader(Pe.requestIdHeader, r), this._config.enableRequestHeaderTracking && (n.ajaxData.requestHeaders[Pe.requestIdHeader] = r)); var s = this._config.appId || this._context.appId(); s && (n.setRequestHeader(Pe.requestContextHeader, Pe.requestContextAppIdFormat + s), this._config.enableRequestHeaderTracking && (n.ajaxData.requestHeaders[Pe.requestContextHeader] = Pe.requestContextAppIdFormat + s)), this._isUsingW3CHeaders && (o = new zn(n.ajaxData.traceID, n.ajaxData.spanID), n.setRequestHeader(Pe.traceParentHeader, o.toString()), this._config.enableRequestHeaderTracking && (n.ajaxData.requestHeaders[Pe.traceParentHeader] = o.toString())) } return n } }, Gn.prototype.getFailedFetchDiagnosticsMessage = function (e) { var t = ""; try { m.isNullOrUndefined(e) || (t += "string" == typeof e ? "(url: '" + e + "')" : "(url: '" + e.url + "')") } catch (e) { this._core.logger.throwInternal(v.CRITICAL, A, "Failed to grab failed fetch diagnostics message", { exception: qe.dump(e) }) } return t }, Gn.prototype.onFetchComplete = function (t, e) { if (e) try { if (e.responseFinishedTime = We.Now(), e.CalculateMetrics(), e.ajaxTotalDuration < 0) this._core.logger.throwInternal(v.WARNING, N, "Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.", { fetchDiagnosticsMessage: this.getFailedFetchDiagnosticsMessage(t), requestSentTime: e.requestSentTime, responseFinishedTime: e.responseFinishedTime }); else { var i = { id: "|" + e.traceID + "." + e.spanID, target: e.getAbsoluteUrl(), name: e.getPathName(), type: "Fetch", duration: e.ajaxTotalDuration, success: 200 <= t.status && t.status < 400, responseCode: t.status, properties: { HttpMethod: e.method } }, n = this.getFetchCorrelationContext(t); if (n && (i.correlationContext = n), this._config.enableRequestHeaderTracking && 0 < Object.keys(e.requestHeaders).length && (i.properties = i.properties || {}, i.properties.requestHeaders = e.requestHeaders), this._config.enableResponseHeaderTracking) { var r = {}; t.headers.forEach(function (e, t) { r[t] = e }), 0 < Object.keys(r).length && (i.properties = i.properties || {}, i.properties.responseHeaders = r) } this.trackDependencyDataInternal(i) } } catch (e) { this._core.logger.throwInternal(v.WARNING, M, "Failed to calculate the duration of the fetch call, monitoring data for this fetch call won't be sent.", { fetchDiagnosticsMessage: this.getFailedFetchDiagnosticsMessage(t), exception: qe.dump(e) }) } }, Gn.prototype.onFetchFailed = function (t, e, i) { if (e) try { if (e.responseFinishedTime = We.Now(), e.CalculateMetrics(), e.ajaxTotalDuration < 0) this._core.logger.throwInternal(v.WARNING, N, "Failed to calculate the duration of the failed fetch call, monitoring data for this fetch call won't be sent.", { fetchDiagnosticsMessage: this.getFailedFetchDiagnosticsMessage(t), requestSentTime: e.requestSentTime, responseFinishedTime: e.responseFinishedTime }); else { var n = { id: "|" + e.traceID + "." + e.spanID, target: e.getAbsoluteUrl(), name: e.getPathName(), type: "Fetch", duration: e.ajaxTotalDuration, success: !1, responseCode: 0, properties: { HttpMethod: e.method } }; this.trackDependencyDataInternal(n, { error: i.message }) } } catch (e) { this._core.logger.throwInternal(v.WARNING, M, "Failed to calculate the duration of the failed fetch call, monitoring data for this fetch call won't be sent.", { fetchDiagnosticsMessage: this.getFailedFetchDiagnosticsMessage(t), exception: qe.dump(e) }) } }, Gn.prototype.getFetchCorrelationContext = function (t) { try { var e = t.headers.get(Pe.requestContextHeader); return ze.getCorrelationContext(e) } catch (e) { this._core.logger.throwInternal(v.WARNING, M, "Failed to get Request-Context correlation header as it may be not included in the response or not accessible.", { fetchDiagnosticsMessage: this.getFailedFetchDiagnosticsMessage(t), exception: qe.dump(e) }) } }, Gn.prototype.instrumentXhr = function () { this.supportsAjaxMonitoring() && !this.initialized && (this.instrumentOpen(), this.instrumentSend(), this.instrumentAbort(), this.instrumentSetRequestHeader(), this.initialized = !0) }, Gn.getDefaultConfig = function () { return { maxAjaxCallsPerView: 500, disableAjaxTracking: !1, disableFetchTracking: !0, disableCorrelationHeaders: !1, distributedTracingMode: s.AI, correlationHeaderExcludedDomains: ["*.blob.core.windows.net", "*.blob.core.chinacloudapi.cn", "*.blob.core.cloudapi.de", "*.blob.core.usgovcloudapi.net"], correlationHeaderDomains: void 0, appId: void 0, enableCorsCorrelation: !1, enableRequestHeaderTracking: !1, enableResponseHeaderTracking: !1 } }, Gn.getEmptyConfig = function () { return { maxAjaxCallsPerView: void 0, disableAjaxTracking: void 0, disableFetchTracking: void 0, disableCorrelationHeaders: void 0, distributedTracingMode: void 0, correlationHeaderExcludedDomains: void 0, appId: void 0, enableCorsCorrelation: void 0, correlationHeaderDomains: void 0, enableRequestHeaderTracking: void 0, enableResponseHeaderTracking: void 0 } }, Gn.prototype.initialize = function (e, t, i) { if (!this.initialized && !this._fetchInitialized) { this._core = t; var n = Gn.getDefaultConfig(); for (var r in this._config = Gn.getEmptyConfig(), n) this._config[r] = di.getConfig(e, r, Gn.identifier, n[r]); if (this._isUsingAIHeaders = this._config.distributedTracingMode === s.AI || this._config.distributedTracingMode === s.AI_AND_W3C, this._isUsingW3CHeaders = this._config.distributedTracingMode === s.AI_AND_W3C || this._config.distributedTracingMode === s.W3C, !1 === this._config.disableAjaxTracking && this.instrumentXhr(), !1 === this._config.disableFetchTracking && this.instrumentFetch(), 0 < i.length && i) { for (var a = void 0, o = 0; !a && o < i.length;)i[o] && i[o].identifier === _i && (a = i[o]), o++; a && (this._context = a.context) } } }, Gn.identifier = "AjaxDependencyPlugin", Gn); function Gn() { this._trackAjaxAttempts = 0, this.identifier = Gn.identifier, this.priority = 120, this.currentWindowHost = window && window.location && window.location.host && window.location.host.toLowerCase(), this.initialized = !1, this._fetchInitialized = !1 } var Wn = (Xn.prototype.trackEvent = function (e, t) { this.appInsights.trackEvent(e, t) }, Xn.prototype.trackPageView = function (e) { var t = e || {}; this.appInsights.trackPageView(t) }, Xn.prototype.trackPageViewPerformance = function (e) { var t = e || {}; this.appInsights.trackPageViewPerformance(t) }, Xn.prototype.trackException = function (e) { !e.exception && e.error && (e.exception = e.error), this.appInsights.trackException(e) }, Xn.prototype._onerror = function (e) { this.appInsights._onerror(e) }, Xn.prototype.trackTrace = function (e, t) { this.appInsights.trackTrace(e, t) }, Xn.prototype.trackMetric = function (e, t) { this.appInsights.trackMetric(e, t) }, Xn.prototype.startTrackPage = function (e) { this.appInsights.startTrackPage(e) }, Xn.prototype.stopTrackPage = function (e, t, i, n) { this.appInsights.stopTrackPage(e, t, i, n) }, Xn.prototype.startTrackEvent = function (e) { this.appInsights.startTrackEvent(e) }, Xn.prototype.stopTrackEvent = function (e, t, i) { this.appInsights.stopTrackEvent(e, t, i) }, Xn.prototype.addTelemetryInitializer = function (e) { return this.appInsights.addTelemetryInitializer(e) }, Xn.prototype.setAuthenticatedUserContext = function (e, t, i) { void 0 === i && (i = !1), this.properties.context.user.setAuthenticatedUserContext(e, t, i) }, Xn.prototype.clearAuthenticatedUserContext = function () { this.properties.context.user.clearAuthenticatedUserContext() }, Xn.prototype.trackDependencyData = function (e) { this.dependencies.trackDependencyData(e) }, Xn.prototype.flush = function (t) { void 0 === t && (t = !0), this.core.getTransmissionControls().forEach(function (e) { e.forEach(function (e) { e.flush(t) }) }) }, Xn.prototype.onunloadFlush = function (t) { void 0 === t && (t = !0), this.core.getTransmissionControls().forEach(function (e) { e.forEach(function (e) { e.onunloadFlush ? e.onunloadFlush() : e.flush(t) }) }) }, Xn.prototype.loadAppInsights = function (e) { if (void 0 === e && (e = !1), e && this.config.extensions && 0 < this.config.extensions.length) throw new Error("Extensions not allowed in legacy mode"); var t = [], i = new _n; return t.push(i), t.push(this.properties), t.push(this.dependencies), t.push(this.appInsights), this.core.initialize(this.config, t), this.emptyQueue(), this.pollInternalLogs(), this.addHousekeepingBeforeUnload(this), this.context = this.properties.context, this }, Xn.prototype.updateSnippetDefinitions = function (e) { for (var t in this) "string" == typeof t && (e[t] = this[t]) }, Xn.prototype.emptyQueue = function () { try { if (qe.isArray(this.snippet.queue)) { for (var e = this.snippet.queue.length, t = 0; t < e; t++)(0, this.snippet.queue[t])(); this.snippet.queue = void 0, delete this.snippet.queue } } catch (e) { var i = {}; e && "function" == typeof e.toString && (i.exception = e.toString()) } }, Xn.prototype.pollInternalLogs = function () { this.core.pollInternalLogs() }, Xn.prototype.addHousekeepingBeforeUnload = function (t) { !t.appInsights.config.disableFlushOnBeforeUnload && "onbeforeunload" in window && (qe.addEventHandler("beforeunload", function () { t.onunloadFlush(!1); var e = t.appInsights.core._extensions[_i]; e && e.context && e.context._sessionManager && e.context._sessionManager.backup() }) || t.appInsights.core.logger.throwInternal(v.CRITICAL, P, "Could not add handler for beforeunload")) }, Xn.prototype.getSKUDefaults = function () { this.config.diagnosticLogInterval = this.config.diagnosticLogInterval && 0 < this.config.diagnosticLogInterval ? this.config.diagnosticLogInterval : 1e4 }, Xn); function Xn(e) { e.queue = e.queue || [], e.version = e.version || 2; var t = e.config || {}; t && !t.instrumentationKey && (t = e, Mi.Version = "2.2.2"), this.appInsights = new Mi, this.properties = new Un, this.dependencies = new Bn, this.core = new Re, this.snippet = e, this.config = t, this.getSKUDefaults() } var Kn = (Jn.getAppInsights = function (e, t) { var i = new Wn(e), n = 2 !== t; if (2 === t) return i.updateSnippetDefinitions(e), i.loadAppInsights(n), i; var r = new bi(e, i); return r.updateSnippetDefinitions(e), i.loadAppInsights(n), r }, Jn); function Jn() { } try { var Yn; if ("undefined" != typeof window && "undefined" != typeof JSON && (Yn = window.appInsightsSDK || "appInsights", void 0 !== window[Yn])) { var Qn = window[Yn] || { version: 2 }; (2 === Qn.version && window[Yn].initialize || void 0 === Qn.version) && Kn.getAppInsights(Qn, Qn.version) } } catch (e) { console && console.warn("Failed to initialize AppInsights JS SDK for instance " + Yn + e.message) } e.ApplicationInsights = Wn, Object.defineProperty(e, "__esModule", { value: !0 }) });
//# sourceMappingURL=ai.2.min.js.map